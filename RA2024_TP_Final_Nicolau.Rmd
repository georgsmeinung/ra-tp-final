---
title: "Regresión Avanzada 2024 - TP Final"
author: "Jorge Nicolau"
output:
  html_document:
    toc: true
    code_folding: show
    toc_float: false
    df_print: paged
    theme: united
    code_download: true
    toc_depth: 2
  word_document:
    toc: true
    toc_depth: '2'
references:
  - id: brachman-no-date
    author: "Brachman, R. Z."
    title: "How to Analyze Your Data | How to Get Started – Exoplanet Exploration: Planets Beyond our Solar System"
    publisher: "Exoplanet Exploration: Planets Beyond Our Solar System"
    url: "https://exoplanets.nasa.gov/exoplanet-watch/how-to-contribute/how-to-analyze-your-data/"
  - id: neofronteras-no-date
    author: "NeoFronteras"
    title: "Detección de exoplanetas por astrometría"
    publisher: "NeoFronteras"
    url: "https://neofronteras.com/?p=8093"
  - id: alonso-sobrino-2006
    author: "Alonso Sobrino, Roi"
    title: "Detección y caracterización de exoplanetas mediante el método de los tránsitos"
    year: 2006
    publisher: "Instituto de Astrofísica de Canarias (IAC)"
    url: "https://www.iac.es/es/ciencia-y-tecnologia/publicaciones/deteccion-y-caracterizacion-de-exoplanetas-mediante-el-metodo-de-los-transitos"
  - id: georgsmeinung-no-date
    author: "Georgsmeinung"
    title: "GitHub - georgsmeinung/ra-tp-final"
    publisher: "GitHub"
    url: "https://github.com/georgsmeinung/ra-tp-final/"
  - id: ipac-no-date
    author: "IPAC"
    title: "Our mission"
    url: "https://www.ipac.caltech.edu/page/mission"
  - id: kane-gelino-2012
    author: "Kane, Stephen R. & Gelino, Dawn M."
    title: "The habitable zone and extreme planetary orbits"
    journal: "Astrobiology"
    year: 2012
    volume: 12
    number: 10
    pages: "940-945"
    doi: "10.1089/ast.2011.0798"
    url: "https://doi.org/10.1089/ast.2011.0798"
  - id: kopparapu-ramirez-2013
    author: "Kopparapu, R. K., Ramirez, R., Kasting, J. F., Eymet, V., Robinson, T. D., Mahadevan, S., Terrien, R. C., Domagal-Goldman, S., Meadows, V., & Deshpande, R."
    title: "Habitable zones around main-sequence stars: new estimates"
    journal: "The Astrophysical Journal"
    year: 2013
    volume: 765
    number: 2
    pages: "131"
    doi: "10.1088/0004-637x/765/2/131"
    url: "https://doi.org/10.1088/0004-637x/765/2/131"
  - id: marin-2014
    author: "Marín, Daniel"
    title: "Detectando planetas desde el espacio gracias a Einstein - Eureka"
    publisher: "Eureka"
    year: 2014
    url: "https://danielmarin.naukas.com/2011/05/23/detectando-planetas-desde-el-espacio-gracias-a-einstein/"
  - id: mendez-rivera-2021
    author: "Méndez, Abel, Rivera-Valentin, Edgard, Schulze-Makuch, Dirk, Filiberto, Justin, Ramirez, Ramses, Wood, Tana, Dávila, Alfonso, McKay, Chris, Ceballos, Kevin, Jusino-Maldonado, Marcos, Torres-Santiago, Nicole, Gomez, Guillermo Nery, Heller, René, Byrne, Paul, Malaska, Michael, Nathan, Erica, Simões, Marta, Antunes, André, Martínez-Frías, Jesús, & Haqq-Misra, Jacob."
    title: "Habitability Models for Astrobiology"
    journal: "Astrobiology"
    year: 2021
    doi: "10.1089/ast.2020.2342"
    url: "https://www.researchgate.net/publication/353861442_Habitability_Models_for_Astrobiology"
  - id: ipac-exoplanet-archive-no-date
    author: "IPAC"
    title: "NASA Exoplanet Archive overview and holdings"
    url: "https://exoplanetarchive.ipac.caltech.edu/docs/intro.html"
  - id: ipac-exoplanet-science-no-date
    author: "IPAC"
    title: "NASA Exoplanet Archive"
    publisher: "NASA Exoplanet Science Institute"
    url: "https://exoplanetarchive.ipac.caltech.edu/cgi-bin/TblView/nph-tblView?app=ExoTbls&config=PS"
  - id: nardi-2024
    author: "Nardi, Luca"
    title: "¿Cuáles son las técnicas utilizadas para descubrir exoplanetas?"
    publisher: "WIRED"
    year: 2024
    month: "August 26"
    url: "https://es.wired.com/articulos/cuales-son-las-tecnicas-utilizadas-para-descubrir-exoplanetas"
  - id: ipac-planetary-data-no-date
    author: "IPAC"
    title: "Planetary Systems and Planetary Systems Composite Parameters Data Column Definitions"
    url: "https://exoplanetarchive.ipac.caltech.edu/docs/API_PS_columns.html"
  - id: shields-ballard-2016
    author: "Shields, Aomawa L., Ballard, Sarah, & Johnson, John Asher"
    title: "The habitability of planets orbiting M-dwarf stars"
    journal: "Physics Reports"
    year: 2016
    volume: 663
    pages: "1-38"
    doi: "10.1016/j.physrep.2016.10.003"
    url: "https://doi.org/10.1016/j.physrep.2016.10.003"
  - id: webb-nasa-science-no-date
    author: "NASA, Equipo de redacción de Ciencia"
    title: "Webb de la NASA obtiene su primera imagen directa de un mundo distante"
    publisher: "NASA Ciencia"
    url: "https://ciencia.nasa.gov/universo/webb-de-la-nasa-obtiene-su-primera-imagen-directa-de-un-mundo-distante/"
  - id: wolszczan-frail-1992
    author: "Wolszczan, Aleksander & Frail, D. A."
    title: "A planetary system around the millisecond pulsar PSR1257 + 12"
    journal: "Nature"
    year: 1992
    volume: 355
    number: 6356
    pages: "145-147"
    doi: "10.1038/355145a0"
    url: "https://doi.org/10.1038/355145a0"
  - id: marin-2018
    author: "Marín, Daniel"
    title: "EarthFinder: un telescopio espacial para buscar exotierras por el método de la velocidad radial - Eureka"
    year: 2018
    month: "March"
    url: "https://danielmarin.naukas.com/2018/03/14/earthfinder/"
  - id: cermak-2024
    author: "Cermak, A. & Cermak, A."
    title: "Kepler / K2 - NASA Science"
    publisher: "NASA Science"
    year: 2024
    month: "September 3"
    url: "https://science.nasa.gov/mission/kepler/"
editor_options:
  markdown:
    wrap: none
---

::: {style="text-align: center;"}
![](logo-austral.png){width="200px"}
:::

```{r setup, include=FALSE, echo=FALSE}
# Bloque de configuración de R Markdown
# Limpieza del Workspace
rm(list = ls())

# Determinar el directorio del script actual
# y cambiar el working directory al directorio del script actual
library(rstudioapi)
script_full_path <- rstudioapi::getSourceEditorContext()$path
script_path <- file.path(dirname(script_full_path), "")
setwd(script_path)

knitr::opts_chunk$set(echo = TRUE)
# Deshabilita la impresión de tus resultados en notación científica
options(scipen=999)

# Semilla global para reproducibilidad
random_seed <- 235337
set.seed(random_seed)
```

# Detección de exoplanetas y sus características

Durante casi tres décadas de investigación, la NASA ha confirmado la existencia de más de 5,600 exoplanetas en 4,151 sistemas planetarios. Estos mundos, conocidos como exoplanetas o planetas extrasolares, orbitan estrellas distintas al Sol. Aunque los astrónomos los imaginaron durante milenios, no fue hasta mediados de la década de 1990 cuando comenzaron a aparecer en los registros científicos.

Aproximadamente dos tercios de los exoplanetas descubiertos hasta ahora provienen del telescopio espacial Kepler, mientras que cientos más han sido identificados gracias a la misión TESS y otros observatorios terrestres. Estas misiones han generado una enorme cantidad de datos, con cerca de 10,000 posibles exoplanetas aún pendientes de confirmación. Un número impresionante si consideramos que hasta principios de los años noventa no se conocía ninguno, pero diminuto en comparación con los cientos de miles de millones que podrían existir solo en la Vía Láctea.

Para detectar estos mundos, los astrónomos emplean diversas técnicas, muchas de ellas llevadas al límite de la tecnología disponible en los observatorios espaciales [@nardi-2024].

## Métodos de detección de exoplanetas

### Astrometría: detectando exoplanetas a través del movimiento estelar

Cuando decimos que los planetas orbitan alrededor de las estrellas, en realidad no estamos contando toda la historia. En términos precisos, tanto la estrella como sus planetas giran en torno al **baricentro** del sistema, el punto en el espacio donde se equilibra la masa total del conjunto. Dado que las estrellas poseen la mayor parte de la masa, este punto suele ubicarse muy cerca de ellas. En el caso del Sol, por ejemplo, el baricentro se encuentra apenas fuera de su superficie.

Esto implica que una estrella con planetas no permanece completamente estática en el espacio, sino que también se desplaza ligeramente mientras orbita el baricentro del sistema. Al observar esta leve oscilación, los astrónomos pueden detectar la presencia de exoplanetas mediante el método de la **astrometría**. Gracias a esta técnica, se han identificado más de 1,000 planetas extrasolares [@neofronteras-no-date].

### Velocidades radiales: detectando exoplanetas a través del efecto Doppler

La técnica de velocidad radial se basa en el mismo principio que la astrometría: la rotación de la estrella alrededor del baricentro del sistema debido a la influencia gravitatoria de un planeta. Sin embargo, mientras que la astrometría observa directamente el desplazamiento de la estrella en el cielo, la velocidad radial se centra en sus efectos espectroscópicos.

Cuando la estrella se mueve acercándose a nosotros, la frecuencia de su luz se desplaza hacia el azul, y cuando se aleja, se desplaza hacia el rojo. Este fenómeno, conocido como **efecto Doppler**, permite detectar variaciones periódicas en el espectro estelar. Si se observa un patrón rítmico de estos desplazamientos, se puede inferir la presencia de un exoplaneta que provoca el vaivén gravitacional de la estrella [@marin-2018].

### Método del tránsito: detectando exoplanetas a través de su sombra

Más de 4,200 exoplanetas han sido descubiertos mediante el **método del tránsito**, una técnica ampliamente utilizada por el telescopio espacial Kepler. Este método se basa en la observación de la disminución periódica del brillo de una estrella cuando un planeta pasa frente a ella, bloqueando parte de su luz, de manera similar a un eclipse solar.

Al registrar estas variaciones de brillo en múltiples ocasiones, se puede confirmar la presencia de un planeta en órbita. Además, este método proporciona información clave sobre el exoplaneta, como su tamaño y distancia respecto a la estrella. Si el planeta posee una atmósfera, la luz estelar la atraviesa durante el tránsito, permitiendo a los astrónomos analizar su composición química a través de técnicas espectroscópicas. Gracias a esto, es posible estudiar la atmósfera de mundos que ni siquiera podemos observar directamente [@alonso-sobrino-2006].

### Microlente gravitacional: exoplanetas detectados a través de la curvatura del espacio-tiempo

El **método de microlente gravitacional** se basa en un principio fundamental de la **Relatividad General**: la presencia de una masa curva el espacio-tiempo y, como consecuencia, desvía la trayectoria de la luz que pasa cerca de ella. Este fenómeno se conoce como **lente gravitacional** y puede usarse para detectar exoplanetas en circunstancias específicas.

Cuando una estrella lejana se alinea con otra estrella más cercana en nuestra línea de visión, la gravedad de la estrella más cercana actúa como una lente natural, magnificando la luz de la estrella de fondo. Este efecto crea un **aumento temporal del brillo** de la estrella lejana, lo que se conoce como un **evento de microlente gravitacional**.\
Si la estrella más cercana alberga un planeta, la gravedad del planeta también contribuirá al efecto de lente, provocando una **segunda variación en el brillo** de la estrella de fondo. Este cambio adicional en la luz nos permite inferir la presencia del planeta y estimar algunas de sus características, como su masa y distancia con respecto a su estrella [@marin-2014].

### Observación directa: fotografiar exoplanetas en medio del brillo estelar

Detectar exoplanetas mediante **observación directa** es un desafío, ya que estos son cuerpos pequeños y poco luminosos en comparación con las estrellas que orbitan. La intensa luz de la estrella suele eclipsar por completo la presencia del planeta, dificultando su detección.

Sin embargo, existe una técnica para superar este problema: el uso de **coronógrafos**. Estos dispositivos bloquean la luz directa de la estrella, permitiendo que la tenue luz reflejada por el planeta sea visible. El concepto es similar a tapar el Sol con la mano para ver mejor lo que hay en el horizonte.

Para que este método funcione, el planeta debe estar **lo suficientemente alejado de su estrella**, de modo que el coronógrafo pueda aislar su luz. Cuando esto ocurre, es posible capturar imágenes reales del exoplaneta, lo que se conoce como **observación directa**. Gracias a esta técnica, los astrónomos pueden analizar la luz reflejada por el planeta y obtener información sobre su composición, temperatura y atmósfera [@webb-nasa-science-no-date].

### Detección de exoplanetas por cómo afectan la rotación de púlsares

Los **púlsares** son un tipo especial de **estrellas de neutrones**, formadas tras la explosión de una supernova y comprimidas por la gravedad hasta alcanzar una densidad extrema. Estas estrellas pueden girar a velocidades sorprendentes, llegando a completar **decenas o incluso cientos de vueltas por segundo**.

Una de las características más notables de los púlsares es la **precisión de su rotación**. Por ejemplo, el **púlsar del Cangrejo**, uno de los más estudiados, gira exactamente **33 veces por segundo**. Sin embargo, si un planeta orbita alrededor de un púlsar, su influencia gravitacional puede provocar **pequeñas variaciones en la periodicidad de los pulsos**.

Midiendo con precisión estas sutiles anomalías en el tiempo de rotación, los astrónomos pueden **inferir la presencia de planetas** en sistemas de púlsares, un método que ha permitido descubrir algunos de los primeros exoplanetas conocidos [@wolszczan-frail-1992].

## Detección de exoplanetas usando la ciencia de datos

La detección de exoplanetas es un campo de investigación en constante evolución, con nuevos descubrimientos y técnicas emergentes que amplían nuestro conocimiento del universo. La ciencia de datos juega un papel fundamental en este proceso, permitiendo a los astrónomos analizar grandes volúmenes de datos y extraer información relevante sobre los exoplanetas y sus características.

Incluso NASA anima a la detección amateur de exoplanetas a traves de su sitio Exoplanet Watch donde ofrece una guía detallada sobre cómo analizar observaciones de tránsitos de exoplanetas para generar curvas de luz, que representan las variaciones en el brillo de una estrella cuando un planeta pasa frente a ella [@brachman-no-date].

NASA ha recopilado una gran cantidad de datos sobre exoplanetas detectados por misiones como Kepler y TESS, proporcionando una fuente invaluable de información para la investigación científica. Estos datos contienen una variedad de características sobre los exoplanetas y sus sistemas estelares, incluyendo su masa, radio, temperatura, órbita y composición química. Sin embargo esta información no siempre es completa y en muchos casos es necesario realizar análisis avanzados para extraer parámetros faltantes y predecir la habitabilidad de los exoplanetas.

El objetivo de este trabajo es procesar los datos para realizar un análisis exploratorio y utilizar regresión lineal y logística para la extracción de paramétros faltantes de los exoplanetas y para predecir la habitabilidad de los mismos.

# El dataset de expolanetas detectados con el telescopio espacial Kepler

El **Archivo de Exoplanetas de la NASA** es un catálogo astronómico en línea y un servicio de datos que recopila, correlaciona y organiza información sobre exoplanetas y sus estrellas anfitrionas. Además, proporciona herramientas para trabajar con estos datos.

Este archivo está dedicado a la recopilación y difusión de **conjuntos de datos públicos clave** utilizados en la búsqueda y caracterización de planetas extrasolares y sus estrellas [@ipac-exoplanet-archive-no-date]. Entre los datos disponibles se incluyen:

-   **Parámetros estelares**: posiciones, magnitudes y temperaturas de las estrellas anfitrionas.\
-   **Parámetros de exoplanetas**: masas, características orbitales y otros datos fundamentales.\
-   **Datos de descubrimiento y caracterización**: curvas de velocidad radial publicadas, curvas de luz fotométricas, imágenes y espectros.

Esta base de datos es una herramienta esencial para la investigación en el campo de la **astronomía de exoplanetas** y ha sido utilizada en numerosos estudios científicos y proyectos de investigación. Se encuentra disponible en línea y es de libre acceso para la comunidad científica y el público en general en el sitio del IPAC del Caltech. El **IPAC (Infrared Processing and Analysis Center)** es un centro de investigación y procesamiento de datos astronómicos ubicado en el **Instituto de Tecnología de California (Caltech)**. Se especializa en la gestión y análisis de datos de misiones espaciales y telescopios astronómicos, en colaboración con agencias como la **NASA, la Fundación Nacional de Ciencias (NSF) y el Laboratorio de Propulsión a Chorro (JPL)** [@ipac-no-date].

Al momento de la extracción (14 de enero de 2025) el dataset de exoplanetas contiene información sobre 28.217 exoplanetas (entre confirmados, propuestos y en estudio) y sus características. La base de datos de IPAC contiene información sobre los exoplanetas detectados por la misión Kepler y otros telescopios, pero para este trabajo se utilizará solo la información de los exoplanetas detectados por la misión Kepler [@cermak-2024].

Se cargarán los datos, se filtrarán las filas de los explonetas confirmados, las columnas relevantes, se eliminarán los valores faltantes y se realizará un análisis exploratorio de los datos para luego realizar la regresión lineal y logística.

## Preprocesamiento de datos

Se cargan los datos del dataset de exoplanetas de la misión Kepler del archivo **`keplerexoplanets.csv`**. El mismo se obtuvo de la página del IPAC del Caltech [@ipac-exoplanet-science-no-date]. La consulta usada para producir el dataset fue la siguiente:

```         
# This file was produced by the NASA Exoplanet Archive  http://exoplanetarchive.ipac.caltech.edu
# Tue Jan 14 15:20:53 2025
#
# User preference: *
#
# CONSTRAINT:  where (disc_facility like '%Kepler%')
#
# COLUMN pl_name:        Planet Name
# COLUMN hostname:       Host Name
# COLUMN pl_letter:      Planet Letter
# COLUMN hd_name:        HD ID
# COLUMN hip_name:       HIP ID
# COLUMN tic_id:         TIC ID
# COLUMN gaia_id:        GAIA ID
# COLUMN default_flag:   Default Parameter Set
# COLUMN sy_snum:        Number of Stars
# COLUMN sy_pnum:        Number of Planets
# COLUMN sy_mnum:        Number of Moons
# COLUMN cb_flag:        Circumbinary Flag
# COLUMN discoverymethod: Discovery Method
# COLUMN disc_year:      Discovery Year
# COLUMN disc_refname:   Discovery Reference
# COLUMN disc_pubdate:   Discovery Publication Date
# COLUMN disc_locale:    Discovery Locale
# COLUMN disc_facility:  Discovery Facility
# COLUMN disc_telescope: Discovery Telescope
# COLUMN disc_instrument: Discovery Instrument
# COLUMN rv_flag:        Detected by Radial Velocity Variations
# COLUMN pul_flag:       Detected by Pulsar Timing Variations
# COLUMN ptv_flag:       Detected by Pulsation Timing Variations
# COLUMN tran_flag:      Detected by Transits
# COLUMN ast_flag:       Detected by Astrometric Variations
# COLUMN obm_flag:       Detected by Orbital Brightness Modulations
# COLUMN micro_flag:     Detected by Microlensing
# COLUMN etv_flag:       Detected by Eclipse Timing Variations
# COLUMN ima_flag:       Detected by Imaging
# COLUMN dkin_flag:      Detected by Disk Kinematics
# COLUMN soltype:        Solution Type
# COLUMN pl_controv_flag: Controversial Flag
# COLUMN pl_refname:     Planetary Parameter Reference
# COLUMN pl_orbper:      Orbital Period [days]
# COLUMN pl_orbsmax:     Orbit Semi-Major Axis [au]
# COLUMN pl_rade:        Planet Radius [Earth Radius]
# COLUMN pl_radj:        Planet Radius [Jupiter Radius]
# COLUMN pl_masse:       Planet Mass [Earth Mass]
# COLUMN pl_massj:       Planet Mass [Jupiter Mass]
# COLUMN pl_msinie:      Planet Mass*sin(i) [Earth Mass]
# COLUMN pl_msinij:      Planet Mass*sin(i) [Jupiter Mass]
# COLUMN pl_cmasse:      Planet Mass*sin(i)/sin(i) [Earth Mass]
# COLUMN pl_cmassj:      Planet Mass*sin(i)/sin(i) [Jupiter Mass]
# COLUMN pl_bmasse:      Planet Mass or Mass*sin(i) [Earth Mass]
# COLUMN pl_bmassj:      Planet Mass or Mass*sin(i) [Jupiter Mass]
# COLUMN pl_bmassprov:   Planet Mass or Mass*sin(i) Provenance
# COLUMN pl_dens:        Planet Density [g/cm**3]
# COLUMN pl_orbeccen:    Eccentricity
# COLUMN pl_insol:       Insolation Flux [Earth Flux]
# COLUMN pl_eqt:         Equilibrium Temperature [K]
# COLUMN pl_orbincl:     Inclination [deg]
# COLUMN pl_tranmid:     Transit Midpoint [days]
# COLUMN pl_tsystemref:  Time Reference Frame and Standard
# COLUMN ttv_flag:       Data show Transit Timing Variations
# COLUMN pl_imppar:      Impact Parameter
# COLUMN pl_trandep:     Transit Depth [%]
# COLUMN pl_trandur:     Transit Duration [hours]
# COLUMN pl_ratdor:      Ratio of Semi-Major Axis to Stellar Radius
# COLUMN pl_ratror:      Ratio of Planet to Stellar Radius
# COLUMN pl_occdep:      Occultation Depth [%]
# COLUMN pl_orbtper:     Epoch of Periastron [days]
# COLUMN pl_orblper:     Argument of Periastron [deg]
# COLUMN pl_rvamp:       Radial Velocity Amplitude [m/s]
# COLUMN pl_projobliq:   Projected Obliquity [deg]
# COLUMN pl_trueobliq:   True Obliquity [deg]
# COLUMN st_refname:     Stellar Parameter Reference
# COLUMN st_spectype:    Spectral Type
# COLUMN st_teff:        Stellar Effective Temperature [K]
# COLUMN st_rad:         Stellar Radius [Solar Radius]
# COLUMN st_mass:        Stellar Mass [Solar mass]
# COLUMN st_met:         Stellar Metallicity [dex]
# COLUMN st_metratio:    Stellar Metallicity Ratio
# COLUMN st_lum:         Stellar Luminosity [log(Solar)]
# COLUMN st_logg:        Stellar Surface Gravity [log10(cm/s**2)]
# COLUMN st_age:         Stellar Age [Gyr]
# COLUMN st_dens:        Stellar Density [g/cm**3]
# COLUMN st_vsin:        Stellar Rotational Velocity [km/s]
# COLUMN st_rotp:        Stellar Rotational Period [days]
# COLUMN st_radv:        Systemic Radial Velocity [km/s]
# COLUMN sy_refname:     System Parameter Reference
# COLUMN rastr:          RA [sexagesimal]
# COLUMN ra:             RA [deg]
# COLUMN decstr:         Dec [sexagesimal]
# COLUMN dec:            Dec [deg]
# COLUMN glat:           Galactic Latitude [deg]
# COLUMN glon:           Galactic Longitude [deg]
# COLUMN elat:           Ecliptic Latitude [deg]
# COLUMN elon:           Ecliptic Longitude [deg]
# COLUMN sy_pm:          Total Proper Motion [mas/yr]
# COLUMN sy_pmra:        Proper Motion (RA) [mas/yr]
# COLUMN sy_pmdec:       Proper Motion (Dec) [mas/yr]
# COLUMN sy_dist:        Distance [pc]
# COLUMN sy_plx:         Parallax [mas]
# COLUMN sy_bmag:        B (Johnson) Magnitude
# COLUMN sy_vmag:        V (Johnson) Magnitude
# COLUMN sy_jmag:        J (2MASS) Magnitude
# COLUMN sy_hmag:        H (2MASS) Magnitude
# COLUMN sy_kmag:        Ks (2MASS) Magnitude
# COLUMN sy_umag:        u (Sloan) Magnitude
# COLUMN sy_gmag:        g (Sloan) Magnitude
# COLUMN sy_rmag:        r (Sloan) Magnitude
# COLUMN sy_imag:        i (Sloan) Magnitude
# COLUMN sy_zmag:        z (Sloan) Magnitude
# COLUMN sy_w1mag:       W1 (WISE) Magnitude
# COLUMN sy_w2mag:       W2 (WISE) Magnitude
# COLUMN sy_w3mag:       W3 (WISE) Magnitude
# COLUMN sy_w4mag:       W4 (WISE) Magnitude
# COLUMN sy_gaiamag:     Gaia Magnitude
# COLUMN sy_icmag:       I (Cousins) Magnitude
# COLUMN sy_tmag:        TESS Magnitude
# COLUMN sy_kepmag:      Kepler Magnitude
# COLUMN rowupdate:      Date of Last Update
# COLUMN pl_pubdate:     Planetary Parameter Reference Publication Date
# COLUMN releasedate:    Release Date
# COLUMN pl_nnotes:      Number of Notes
# COLUMN st_nphot:       Number of Photometry Time Series
# COLUMN st_nrvc:        Number of Radial Velocity Time Series
# COLUMN st_nspec:       Number of Stellar Spectra Measurements
# COLUMN pl_nespec:      Number of Eclipse Spectra
# COLUMN pl_ntranspec:   Number of Transmission Spectra
# COLUMN pl_ndispec:     Number of Direct Imaging Spectra
#
```

El encabezado más arriba estaba incluído en el archivo .CSV generado y se incluye aquí para reproducir la consulta. El dataset contiene información sobre los sistemas exoplanetarios detectados por la misión Kepler y el diccionario de datos se encuentra en línea [@ipac-planetary-data-no-date] explicando en más profundidad la semántica de las variables.

Todos los archivos necesarios para este trabajo se encuentran en el repositorio de GitHub del autor [@georgsmeinung-no-date] y se pueden descargar desde allí para reproducir este análisis, incluyendo el dataset **`keplerexoplanets.csv`** que a continuación se carga.

```{r load_data, message=FALSE, warning=FALSE, paged.print=FALSE}
library(readr)

# Cargar los datos del archivo CSV
kepler_data <- read_csv("keplerexoplanets.csv")
```

**Estructura de los Datos**

```{r show_data_str, echo=FALSE}

library(knitr)

# Capturar la salida de str() como texto
str_output <- capture.output(str(kepler_data, list.len = Inf, give.attr=FALSE))

# Convertir la salida en un data frame para formatearla como tabla
str_df <- data.frame(
  Details = str_output,
  stringsAsFactors = FALSE
)

# Mostrar la salida en formato de tabla con kable
kable(str_df, col.names = c("Tipo de datos y previsualización"), align = "l")

```

Para el análisis se considerarán solo los exoplanetas confirmados y se eliminarán las columnas no relevantes para el análisis.

Para reducir la dimensionalidad del problema, a continuación se eliminan las columnas con referencias a sitios web no relevantes para el análisis. También se eliminan los datos de referencia de los planetas, estrellas y sistemas no relevantes para el análisis tales como referencias a catálogos externos de estrellas y sistemas, información de publicación del descubrimiento, información de detección, información de fotometría, banderas de organización interna del dataset, información del sistema planetario y detalles técnicos de la detección.

Para reducir la cantidad de registros del dataset y como se busca predecir la habitabilidad de los exoplanetas en sistemas similares al Solar, se filtran los sistemas con estrellas de tamaño similar al Sol (0.9 a 1.1 radios solares). Hay muchas entradas con valores faltantes en las columnas de tipo espectral de las estrellas (la mayoría) que sería un mejor indicador para determinarl la zona habitable, por eso se toma como criterio de filtro el tamaño de las estrellas. Además se consideraran para la muesta solo los exoplanetas publicados en la literatura científica, por lo que se filtra por "Published Confirmed" en la columna **`soltype`**.

```{r filter_data}

library(dplyr)

# PARTE 1 - FILTRO DE DATOS
# Seleccionar los sistemas con estrellas de tamaño
# similar al Sol (0.9 a 1.1 radios solares)
kepler_data <- filter(kepler_data, st_rad >= 0.9 & st_rad <= 1.1)

# Seleccionar solo los exoplanetas publicados en la literatura científica
kepler_data <- filter(kepler_data, soltype == "Published Confirmed")

# PARTE 2 - REDUCCION DE LA DIMENSIONALIDAD
# Eliminar columnas de referencias a sitios web
kepler_data <- subset(kepler_data, select = c(-disc_refname, -pl_refname, -st_refname, -sy_refname))

# Eliminar columnas de id de catalogos externos de estrellas y sistemas
kepler_data <- subset(kepler_data, select = c(-tic_id, -gaia_id))

# Eliminar información referente a la publicación del descubrimiento
# así como la información del instrumento utilizado, para todos es Kepler
kepler_data <- subset(kepler_data, select = c(-disc_year, -disc_pubdate, -disc_locale, -disc_facility, -disc_telescope, -disc_instrument, -rowupdate, -pl_pubdate, -releasedate))

# Eliminar columnas con información referente a la detección
kepler_data <- subset(kepler_data, select = c(-rv_flag, -pul_flag, -ptv_flag, -tran_flag, -ast_flag, -obm_flag, -micro_flag, -etv_flag, -ima_flag, -dkin_flag))

# Eliminar columnas con información de fotometria
kepler_data <- subset(kepler_data, select = c(-sy_bmag, -sy_vmag, -sy_jmag, -sy_hmag, -sy_kmag, -sy_umag, -sy_gmag, -sy_rmag, -sy_imag, -sy_zmag, -sy_w1mag, -sy_w2mag, -sy_w3mag, -sy_w4mag, -sy_gaiamag, -sy_icmag, -sy_tmag, -sy_kepmag))

# Eliminar banderas de organización interna del dataset
kepler_data <- subset(kepler_data, select = c(-pl_nnotes, -pl_controv_flag, -default_flag))

# Eliminar columnas con información del sistema planetario
# y detalles técnicos de la detección
kepler_data <- subset(kepler_data, select = c(-sy_mnum, -pl_ndispec))

# Eliminar columnas con información adicional de fotometria
kepler_data <- subset( kepler_data, select = c(-st_nphot, -st_nrvc, -st_nspec, -pl_nespec, -pl_ntranspec))

```

El dataset resultante se guarda en un archivo CSV llamado **`keplerfiltered.csv`**. El dataset resultante contiene 2547 registros y 68 columnas.

Las columnas en el dataset filtrado, y su descripción extraída del diccionario de datos [@ipac-planetary-data-no-date], son las siguientes:

```{r show_filtered_data_structure, echo=FALSE}
library(dplyr)
library(knitr)

# Ordenar las columnas alfabéticamente
kepler_data <- kepler_data[, order(names(kepler_data))]

# Copiar el nombre de las columnas a un data frame
column_names <- data.frame(
  Column = names(kepler_data),
  stringsAsFactors = FALSE
)

# Agregar una columna con la descripción de la variable
# Fuente: https://exoplanetarchive.ipac.caltech.edu/docs/API_PS_columns.html
column_names <- column_names %>%
  mutate(Description = c(
    "cb_flag: Flag de circumbinario (el planeta orbita un sistema binario)",
    "dec: Declinación de la estrella (en grados decimales)",
    "decstr: Declinación de la estrella (en grados sexagesimales)",
    "discoverymethod: Método de descubrimiento del planeta",
    "elat: Latitud eclíptica de la estrella (en grados decimales)",
    "elon: Longitud eclíptica de la estrella (en grados decimales)",
    "glat: Latitud galáctica de la estrella (en grados decimales)",
    "glon: Longitud galáctica de la estrella (en grados decimales)",
    "hd_name: Nombre del sistema estelar en el catálogo Henry Draper",
    "hip_name: Nombre del sistema estelar en el catálogo Hipparcos",
    "hostname: Nombre del sistema estelar utilizado en la literatura",
    "pl_bmasse: Mejor estimación de la masa del planeta (en masas terrestres)",
    "pl_bmassj: Mejor estimación de la masa del planeta (en masas jovianas)",
    "pl_bmassprov: Proveedor de la mejor estimación de la masa del planeta (mínima o proyectada)",
    "pl_cmasse: Masa mínima proyectada (en masas terrestres)",
    "pl_cmassj: Masa mínima proyectada (en masas jovianas)",
    "pl_dens: Densidad del planeta (en g/cm³)",
    "pl_eqt: Temperatura de equilibrio del planeta considero como un cuerpo oscur (en grados K)",
    "pl_imppar: Parámetro de impacto del planeta como distancia proyectada del centro del planeta al centro de la estrella (en radios estelares)",
    "pl_insol: Insolación del planeta en terminos la insolación de la tierra (en W/m²)",
    "pl_letter: Letra del planeta en el sistema (primer planeta es b)",
    "pl_masse: Masa del planeta (en masas terrestres)",
    "pl_massj: Masa del planeta (en masas jovianas)",
    "pl_msinie: Mínimo de masa medida por el método de velocidad radial (en masas terrestres)",
    "pl_msinij: Mínimo de masa medida por el método de velocidad radial (en masas jovianas)",
    "pl_occdep: Profundidad del eclipse del planeta en terminos de el flujo relativo decreciente frente a su estrella (en %)",
    "pl_orbeccen: Excentricidad orbital del planeta",
    "pl_orbincl: Inclinación orbital del planeta respecto de la línea de visión desde la Tierra (en grados)",
    "pl_orblper: El argumento del periastro del planeta (en grados)",
    "pl_orbper: Periodo orbital del planeta (en días)",
    "pl_orbsmax: Distancia orbital semieje mayor (en UA)",
    "pl_orbtper: El momento del paso del planeta por el periastro (en grados)",
    "pl_projobliq: Inclinación proyectada del planeta respecto de la línea de visión desde la Tierra (en grados)",
    "pl_rade: Radio del planeta (en radios terrestres)",
    "pl_radj: Radio del planeta (en radios jovianos)",
    "pl_ratdor: cociente del semieje orbital mayor sobre el radio estelar",
    "pl_ratror: cociente del radio del planeta sobre el radio estelar",
    "pl_rvamp: Amplitud de la velocidad radial del planeta (en m/s)",
    "pl_trandep: Profundidad del tránsito del planeta en terminos de el flujo relativo decreciente frente a su estrella (en %)",
    "pl_trandur: Duración del tránsito del planeta (en horas)",
    "pl_tranmid: Tiempo de tránsito medio del planeta respecto de su estrella (en días)",
    "pl_trueobliq: Inclinación verdadera del planeta respecto de la línea de visión desde la Tierra (en grados)",
    "pl_tsystemref: Sistema de Tiempo de Referencia del sistema planetario",
    "ra: Ascensión recta de la estrella (en grados decimales)",
    "rastr: Ascensión recta de la estrella (en grados sexagesimales)",
    "soltype: Disposición del planeta según el conjunto de parámetros planetarios dado",
    "st_age: Edad de la estrella (en Ga, gigaaños, o miles de millones de años)",
    "st_dens: Densidad de la estrella (en g/cm³)",
    "st_logg: Gravedad superficial de la estrella (en logaritmo en base 10 de cm/s²)",
    "st_lum: Luminosidad de la estrella (en logartima en base 10 de unidades solares)",
    "st_mass: Masa de la estrella (en masas solares)",
    "st_met: Medición del contenido de metales en la fotosfera de la estrella en comparación con el contenido de hidrógeno",
    "st_metratio: Relación de metalicidad de la estrella",
    "st_rad: Radio de la estrella (en radios solares)",
    "st_radv: Velocidad radial de la estrella (en km/s)",
    "st_rotp: Periodo de rotación de la estrella (en días)",
    "st_spectype: Tipo espectral de la estrella según el sistema Morgan-Keenan",
    "st_teff: Temperatura efectiva de la estrella (en grados K)",
    "st_vsin: Velocidad de rotación de la estrella (en km/s)",
    "sy_dist: Distancia del sistema (en parsecs)",
    "sy_plx: Paralaje del sistema (en miliarcosegundos)",
    "sy_pm: Movimiento propio del sistema (en miliarcosegundos/año)",
    "sy_pmdec: Movimiento propio del sistema en declinación (en miliarcosegundos/año)",
    "sy_pmra: Movimiento propio del sistema en ascensión recta (en miliarcosegundos/año)",
    "sy_pnum: Número de planetas en el sistema",
    "sy_snum: Número de estrellas en el sistema",
    "ttv_flag: Flag de tránsito de tiempo variante",
    "pl_name: Nombre del planeta"))

# Eliminar de la columna Description el prefijo de la variable
column_names$Description <- gsub("^.*: ", "", column_names$Description)

# Elimina la columna con el numero de fila
rownames(column_names) <- NULL

kable(column_names, col.names = c("Variable", "Descripción"), align = "l")

```

```{r save_filtered_dataset}
# Guardar los datos filtrados en un archivo CSV
write_csv(kepler_data, "keplerfiltered.csv")

# Guardar la estructura de las columnas en un archivo CSV
write_csv(column_names, "keplerdatadictionary.csv")
```

## Análisis exploratorio de datos

Para realizar un análisis exploratorio de los datos, se cargan el nuevo dataset (puede comenzarse el análisis en este punto porque el dataset preprocesado está almacenado en el archivo **`keplerfiltered.csv`**) y se realizan algunas visualizaciones y cálculos descriptivos.

```{r eda_filtered_data, echo=FALSE, message=FALSE, warning=FALSE}

library(ggplot2)
library(dplyr)
library(readr)
library(skimr)
library(knitr)

# Leer los datos completos
kepler_data <- read_csv("keplerfiltered.csv")

# Resumen de los datos con skimr solo variables numéricas
kepler_data_num <- kepler_data %>%
  select_if(is.numeric)

# Generar resumen con skimr 
resumen <- skim(kepler_data_num) 

# Ordenar por nombre de variable
resumen <- resumen[order(resumen$skim_variable), ]

# Filtrar columnas relevantes
resumen <- subset(resumen, select = c(
    skim_variable, numeric.mean, numeric.sd, numeric.p0, numeric.p25, 
    numeric.p50, numeric.p75, numeric.p100, numeric.hist))

# Mostrar tabla formateada
kable(resumen, format = "markdown", digits = 4,
      col.names = c("Variable", "Media", "Des.Est.", "Mín.", "P25", "Mediana", "P75", "Máx.","Hist.")
      )

```

## Análisis los parámetros numéricos del dataset

En este análisis preliminar se observan varias características en los parámetros del conjunto de datos.

Las variables **`cb_flag`** y **`ttv_flag`** son binarias y presentan valores mayoritariamente en **0**, ya que su media es baja (\~0.0024 y \~0.1496, respectivamente). Esto indica un fuerte **desbalance en los datos**. Además, la variable **`sy_snum`** casi siempre toma el valor de **1**, lo que sugiere que la mayoría de los sistemas tienen una sola estrella.

En cuanto a los parámetros de coordenadas celestes, las variables **`dec`** y **`ra`** (declinación y ascensión recta), así como **`elat, elon, glat`** y **`glon`** (latitudes y longitudes eclípticas y galácticas), muestran distribuciones relativamente centradas. **`elon`** tiene un rango amplio (288-323), mientras que **`glat`** y **`glon`** presentan valores bien concentrados en torno a la media, lo que sugiere la observación de un cúmulo estelar. La longitud eclíptica **`elon`** (288° a 324°) corresponde a la región de las constelaciones de **Capricornio y Acuario**, extendiéndose hacia **Piscis**, mientras que la latitud eclíptica **`elat`** (57° a 72°) es alta, indicando que estos objetos están lejos del plano de la eclíptica y ubicados en el **hemisferio norte eclíptico**.

Dado que **`elat`** presenta valores elevados (muy por encima del plano de la eclíptica), esto indica que los objetos en el conjunto de datos **no están alineados con el disco principal del Sistema Solar**, sino que se encuentran en una región más inclinada del cielo. Esta área corresponde en parte a la región del **Polo Norte Eclíptico**, en la dirección de la constelación del **Dragón (Draco)**.

Las variables **`pl_bmasse`** y **`pl_masse`** (masa en unidades terrestres), así como **`pl_bmassj`** y **`pl_massj`** (masa en unidades jovianas), muestran distribuciones **sesgadas a la derecha**, con valores máximos extremadamente grandes (hasta **25,426 masas terrestres**). Hay una gran cantidad de valores pequeños y algunos valores atípicos muy altos. De manera similar, `pl_rade` (radio en radios terrestres) y **`pl_radj`** (radio en radios jovianos) presentan una **distribución sesgada**, con pocos valores grandes. La mediana de **`pl_rade`** es **2.37**, lo que indica que la mayoría de los exoplanetas en el conjunto tienen **más del doble del tamaño de la Tierra**.

En cuanto a la excentricidad orbital, **`pl_orbeccen`** es mayoritariamente cercana a **0**, lo que sugiere que la mayoría de los exoplanetas tienen **órbitas casi circulares**. La inclinación orbital, representada por **`pl_orbincl`**, muestra una alta concentración en valores cercanos a **90°**, lo que indica que la mayoría de los planetas tienen **órbitas casi perpendiculares a la línea de visión**. Esto es consistente con el método de detección predominante, el **método de tránsito**, que es más efectivo para planetas que pasan frente a su estrella.

El **período orbital** (**`pl_orbper`**) presenta una mediana de **\~13 días**, aunque existen valores extremos de hasta **1,322 días**, lo que indica una gran variabilidad en la duración de las órbitas. Por otro lado, la **temperatura planetaria de equilibrio** (**`pl_eqt`**) tiene una media de **938 K**, con una distribución amplia (mínimo: **251 K**, máximo: **2,188 K**), lo que sugiere una mezcla de **planetas fríos y extremadamente calientes**.

Respecto a la **densidad planetaria** (**`pl_dens`**), la mediana es **2.13 g/cm³**, con una gran variabilidad, lo que refleja una diversidad en la **composición de los exoplanetas**.

En cuanto a las características estelares, las variables **`st_mass`** y **`st_rad`** muestran que la mayoría de las estrellas en el conjunto tienen **masas y radios similares al Sol (\~1.0)**, lo que es coherente con el filtro aplicado en el preprocesamiento. La **temperatura estelar efectiva** (**`st_teff`**) tiene una media de **5,685 K**, lo que es consistente con **estrellas tipo G (similares al Sol)**. Si bien esto puede deberse al filtro aplicado, también está relacionado con la composición y edad de las estrellas.

La variable **`st_logg`** (logaritmo en base 10 de la gravedad estelar superficial) se concentra en valores cercanos a **4.45**, lo que es característico de **estrellas en la secuencia principal** dentro del ciclo de vida estelar. Por su parte, la **luminosidad estelar** (**`st_lum`**) tiene una distribución centrada alrededor de **0** en escala logarítmica, lo que indica que muchas de estas estrellas tienen **luminosidades similares a la del Sol**.

El parámetro **`sy_dist`** (distancia en parsecs del sistema estelar) varía considerablemente, con valores entre **68 pc y 2,879 pc**. La mediana es **\~860 pc**, lo que indica que **la mayoría de estos sistemas están relativamente lejos (más de 2,804 años luz)**.

En cuanto al movimiento propio de las estrellas, las variables **`sy_pm, sy_pmra`** y **`sy_pmdec`** (movimiento propio del sistema estelar en milisegundos de arco por año) están **centradas en 0**, aunque algunas estrellas presentan **movimientos más rápidos**.

El **número de planetas por sistema** (**`sy_pnum`**) tiene una mediana de **2**, aunque algunos sistemas alcanzan **hasta 6 planetas detectados**.

Las variables **`pl_trandep`** y **`pl_trandur`** (profundidad y duración del tránsito) muestran una distribución **sesgada**, con la mayoría de los valores en el extremo inferior. Esto es esperable, ya que la mayoría de los **tránsitos son poco profundos y de corta duración**.

Por otro lado, la **oblicuidad del eje de rotación del planeta** (**`pl_projobliq`**) tiene una mediana en **0°** (indicando que la mayoría de los planetas tienen un eje de rotación perpendicular a la eclíptica de su sistema), aunque se observan valores extremos de hasta **-135°**.

En general, muchas distribuciones en el conjunto de datos están **sesgadas**, con valores extremos que podrían representar **atípicos (outliers) o simplemente reflejar la diversidad de los exoplanetas**. Los datos sobre **masa y radio** indican que la mayoría de los exoplanetas son **relativamente pequeños**, aunque existen algunos extremadamente grandes. La **temperatura** de los planetas varía ampliamente, lo que sugiere una gran diversidad en los tipos de exoplanetas.

Por último, en cuanto a las estrellas, la mayoría son **similares al Sol**, aunque presentan algunas diferencias en **edad y metalicidad**, lo cual es esperable debido al **filtro aplicado en el preprocesamiento**.

## Detención de valores faltantes

Se analiza la cantidad de valores faltantes en el dataset para identificar posibles problemas de calidad de datos.

```{r missing_values_calc}

library(tidyr)

# Calcular la cantidad de valores faltantes por columna
missing_values <- kepler_data %>%
  summarise_all(~sum(is.na(.))) %>%
  gather() %>%
  arrange(desc(value))

# Eliminar las columnas sin valores faltantes
missing_values <- missing_values %>%
  filter(value > 0)

# Total de columnas
total_rows <- nrow(missing_values)

# Calcular el punto medio
midpoint <- ceiling(total_rows / 2)

```

**Valores Faltantes por Columna**

```{r missing_values_graph1, echo=FALSE, message=FALSE, warning=FALSE}

ggplot(missing_values[1:midpoint,], aes(x = reorder(key, value), y = value)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "darkblue", width = 0.5) + # Reducir ancho de las barras
  geom_text(aes(label = value), hjust = -0.2, size = 3) + # Añadir valores al final de las barras
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.1))) + # Añadir margen extra en el eje y
  labs(title = "",
       x = "Columna",
       y = "") +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 10),   # Ajustar tamaño de texto en eje Y
    plot.title = element_text(hjust = 0.5)  # Centrar el título
  )

```

```{r missing_values_graph2, echo=FALSE, message=FALSE, warning=FALSE}

# Crear un gráfico de barras con los valores faltantes que no sean cero
# con la segunda mitad de las filas
ggplot(missing_values[(midpoint+1):total_rows,], aes(x = reorder(key, value), y = value)) +
  geom_bar(stat = "identity", fill = "skyblue", color = "darkblue", width = 0.5) + # Reducir ancho de las barras
  geom_text(aes(label = value), hjust = -0.2, size = 3) + # Añadir valores al final de las barras
  coord_flip() +
  scale_y_continuous(expand = expansion(mult = c(0.01, 0.1))) + # Añadir margen extra en el eje y
  labs(title = "",
       x = "",
       y = "Cantidad de Valores Faltantes") +
  theme_minimal() +
  theme(
    axis.text.y = element_text(size = 10),   # Ajustar tamaño de texto en eje Y
    plot.title = element_text(hjust = 0.5)  # Centrar el título
  )

```

En el análisis del dataset, se detectó una gran cantidad de **valores faltantes** en varias columnas, lo que probablemente se deba a la falta de estimaciones o mediciones para ciertos exoplanetas. Según los prefijos utilizados en las columnas del dataset, las variables pueden clasificarse en tres categorías principales: **parámetros del planeta (con prefijo pl\_)**, **parámetros de la estrella (con prefijo st\_)** y **parámetros del sistema (prefijo sy\_)**.

Como parte del proceso, se analizarán las **variables conocidas de los exoplanetas** para identificar aquellas que puedan actuar como **predictoras** de las variables con valores faltantes. Por ejemplo, en el caso del **radio del exoplaneta** (representado por **`pl_radj`** en radios jovianos y **`pl_rade`** en radios terrestres), que presenta **886 valores faltantes**, es posible estimarlo utilizando otras variables disponibles en el dataset. Algunas de estas incluyen el **período orbital en días** (**`pl_orbper`**, con **450 valores faltantes**), el **tiempo de conjunción** (**`pl_tranmid`**, con **675 valores faltantes**) y el **logaritmo en base 10 de la gravedad superficial de la estrella del sistema planetario** (**`st_logg`**, con **554 valores faltantes**).

Para determinar cuáles de estas variables tienen un mayor potencial como **predictoras**, se utilizará la **matriz de correlación**, que permitirá identificar las relaciones más significativas entre las variables numéricas del dataset. De esta manera, se seleccionarán aquellas que presenten una **correlación positiva o negativa más fuerte** con la variable faltante, lo que facilitará su estimación con un mayor grado de precisión.

## Buscando correlaciones

Se analiza la correlación entre las variables numéricas del dataset para identificar posibles relaciones entre ellas utilizando los métodos de Pearson (detección de correlaciones lineales).

```{r correlation_matrix_pearson}

library(corrplot)

# Calcular la matriz de correlación
correlation_matrix_pearson <- cor(kepler_data_num, use="pairwise.complete.obs" , method = "pearson")

# Ordenar la matriz por nombre de columnas
correlation_matrix_pearson <- correlation_matrix_pearson[order(rownames(correlation_matrix_pearson)), order(colnames(correlation_matrix_pearson))]

# Número de variables
n_vars <- ncol(correlation_matrix_pearson)
half <- ceiling(n_vars / 2)

```

**Matriz de Correlación 1/3 (Pearson Cuadrante Superior)**

```{r plot_correlation_pearson_upper_quadrant, echo=FALSE}

# Parte 1: Primera mitad (diagonal superior)
correlation_matrix_pearson_sup <- correlation_matrix_pearson[1:half, 1:half]
corrplot(
  correlation_matrix_pearson_sup,
  method = "color",
  type = "upper",
  addCoef.col = "black",
  number.cex = 0.5,
  tl.cex = 0.7,
  tl.col = "black",
  col = colorRampPalette(c("indianred", "white", "steelblue"))(20),
  title = ""
)

```

**Matriz de Correlación 2/3 (Pearson Cruce)**

```{r plot_correlation_pearson_cross, echo=FALSE}

# Parte 2: Cruce entre la primera y segunda mitad
correlation_matrix_pearson_cross <- correlation_matrix_pearson[1:half, (half + 1):n_vars]
corrplot(
  correlation_matrix_pearson_cross,
  method = "color",
  type = "full",  # Mostrar todas las correlaciones en esta sección
  addCoef.col = "black",
  number.cex = 0.5,
  tl.cex = 0.7,
  tl.col = "black",
  col = colorRampPalette(c("indianred", "white", "steelblue"))(20),
  title = ""
)

```

**Matriz de Correlación 3/3 (Pearson Cuadrante Inferior)**

```{r plot_correlation_pearson_lower_quadrant, echo=FALSE}

# Parte 3: Segunda mitad (diagonal inferior)
correlation_matrix_pearson_inf <- correlation_matrix_pearson[(half + 1):n_vars, (half + 1):n_vars]
corrplot(
  correlation_matrix_pearson_inf,
  method = "color",
  type = "upper",
  addCoef.col = "black",
  number.cex = 0.5,
  tl.cex = 0.7,
  tl.col = "black",
  col = colorRampPalette(c("indianred", "white", "steelblue"))(20),
  title = ""
)

```

La **matriz de correlación** es una herramienta fundamental en el análisis de datos, ya que permite identificar relaciones **lineales** entre las variables numéricas del dataset. A través de esta matriz, se pueden detectar tanto **correlaciones positivas** (cuando un aumento en una variable está asociado con un aumento en otra) como **correlaciones negativas** (cuando un aumento en una variable está relacionado con una disminución en otra). Estas relaciones pueden ser útiles para entender patrones en los datos y seleccionar las mejores variables predictoras para modelos de estimación.

Un ejemplo de estas correlaciones se observa en la relación entre el **cociente del semieje orbital mayor y el período orbital** (**`pl_ratdor`**), el cual muestra una **correlación positiva** con el **período orbital** (**`pl_orbper`**). Esto sugiere que a medida que el período orbital aumenta, también lo hace este cociente. En contraste, **`pl_ratdor`** presenta una **correlación negativa** con la **temperatura de equilibrio del exoplaneta** (**`pl_eqt`**), lo que indica que los exoplanetas con períodos orbitales largos tienden a tener temperaturas más bajas, lo cual es esperable, ya que suelen estar más alejados de su estrella anfitriona.

En cuanto a la variable que se seleccionó como **variable objetivo** en el análisis previo, el **radio del exoplaneta** (**`pl_radj`**), se observan relaciones significativas con otras variables. Específicamente, tiene una **correlación positiva** con la **profundidad del tránsito** (**`pl_trandep`**), lo que indica que los exoplanetas más grandes generan una mayor disminución en el brillo de su estrella al pasar frente a ella. Por otro lado, **`pl_radj`** muestra una **correlación negativa** con la **gravedad superficial de la estrella anfitriona** (**`st_logg`**), lo que sugiere que los exoplanetas más grandes tienden a encontrarse en sistemas con estrellas de menor gravedad superficial, posiblemente porque estos sistemas albergan planetas de mayor tamaño.

Para visualizar mejor estas relaciones y seleccionar las mejores **variables predictoras**, se realiza un **pair plot** con las variables que presentan una correlación significativa, estableciendo un **umbral del 50% en valor absoluto**. Este gráfico permite examinar cómo se distribuyen los datos y cómo se relacionan las variables entre sí, facilitando la identificación de tendencias y posibles patrones útiles para la estimación de valores faltantes y la construcción de modelos de predicción.

```{r most_correlated_variables, echo=FALSE}

# Seleccionar de la matriz de correlación las variables con correlacion mayor o
# igual a 0.3 en valor absoluto con la variable faltante
correlated_vars <- names(which(abs(correlation_matrix_pearson["pl_radj", ]) >= 0.5))

# Se genera un dataframe con la correlacion entre las variables seleccionadas
# en correlated_vars y la variable faltante tomando de la matriz de correlacion
# solo las filas y columnas correspondientes a las variables seleccionadas
correlation_df <- data.frame(
  Variable = names(correlation_matrix_pearson[correlated_vars, "pl_radj"]),
  Correlacion = correlation_matrix_pearson[correlated_vars, "pl_radj"]
)

# Agregar una columna con la cantidad de valores faltantes
correlation_df$Faltantes <- sapply(correlation_df$Variable, function(x) sum(is.na(kepler_data[[x]])))

# Escribo a correlated_vars las variables seleccionadas
correlated_vars <- correlation_df$Variable

# Ordenar el dataframe por cantidad de faltantes ascendente
# y por valor absoluto de correlación descendente
correlation_df <- correlation_df[order(correlation_df$Faltantes, -abs(correlation_df$Correlacion)), ]

# Eliminar la columna de indice
rownames(correlation_df) <- NULL

# Mostrar tabla formateada
kable(correlation_df, columns = c("Variable","Correlación","Faltantes"), align = "l")

```

```{r pair_plot_correlated_variables, echo=FALSE, warning=FALSE}

panel.hist <- function(x, ...) {
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(usr[1:2], 0, 1.5)) 
  hist(x, col = "indianred", border = "white", probability = TRUE, add = TRUE)
}

pairs(kepler_data_num[, correlated_vars], 
      diag.panel = panel.hist,     # Histogramas en la diagonal
      col = "steelblue", pch = 19, cex = 1.2)

```

Más allá de la relación lineal evidente entre las medidas del **radio del exoplaneta en diferentes unidades** —es decir, **radios jovianos** y **radios terrestres**—, el análisis de correlación revela la presencia de otras relaciones lineales significativas entre el radio del exoplaneta y otras variables del conjunto de datos. Estas relaciones se ordenan en función de su **fuerza de correlación** en orden descendente, destacando tres principales variables:

La primera variable con una fuerte correlación es el **cociente del radio del planeta sobre el radio de su estrella anfitriona** (**`pl_ratror`**). Esta relación tiene sentido desde un punto de vista físico, ya que el tamaño relativo del exoplaneta respecto a su estrella afecta directamente la observación de fenómenos como el tránsito. Cuanto mayor sea este cociente, mayor será el tamaño aparente del exoplaneta durante el tránsito.

La segunda variable con alta correlación es la **profundidad del tránsito** (**`pl_trandep`**). Este valor mide la disminución en el brillo de la estrella cuando el planeta pasa frente a ella. Dado que planetas más grandes bloquean una mayor parte de la luz estelar durante un tránsito, es lógico que exista una relación lineal positiva entre el radio del planeta y la profundidad del tránsito observado.

La tercera variable significativa es la **amplitud de la velocidad radial del planeta** (**`pl_rvamp`**). Esta mide el desplazamiento de la estrella debido al tirón gravitacional del exoplaneta en su órbita. Los exoplanetas de mayor tamaño tienden a ejercer una fuerza gravitacional más intensa sobre la estrella, generando mayores variaciones en la velocidad radial detectada mediante el efecto Doppler, lo que explica esta relación.

Con base en estos resultados, se seleccionan estas tres variables como **variables predictoras** para el radio del exoplaneta, ya que presentan una **alta correlación lineal**, positiva o negativa, con la variable faltante. Estas relaciones proporcionan información clave para realizar estimaciones más precisas del radio del exoplaneta mediante técnicas de regresión, basándose en patrones consistentes en los datos.

## Detección de valores atípicos (outliers) en las predictoras

Para las variables predictoras seleccionadas (**`pl_ratdor`**,**`pl_trandep`**,**`pl_rvamp`**), se detectan valores atípicos en el dataset que puedan afectar el análisis y la predicción de la variable faltante (**`pl_radj`**).

```{r outliers_detection, echo=FALSE, warning=FALSE}

# Seleccionar las variables predictoras
predictor_vars <- c("pl_ratdor", "pl_trandep", "pl_rvamp")

# Crear un data frame con las variables predictoras
predictor_data <- kepler_data_num[predictor_vars]

# Normalizar los datos
predictor_data <- scale(predictor_data)

library(ggplot2)
library(tidyr)

predictor_data <- as.data.frame(predictor_data)

# Convertir a formato largo para ggplot2
data_long <- pivot_longer(predictor_data, cols = everything(), names_to = "Variable", values_to = "Valores")

# Graficar los valores atípicos con un boxplot
ggplot(data_long, aes(x = Variable, y = Valores)) +
  geom_boxplot(outlier.colour = "indianred", outlier.shape = 1, outlier.size = 2, width = 0.2, fill = "steelblue") +
  labs(title = "Boxplot de Variables predictoras",
       x = "Variable", y = "Valores") +
  coord_flip() +
  theme_minimal(base_size = 14)

```

El **boxplot** revela la presencia de **valores atípicos** en las variables predictoras seleccionadas, lo que puede influir significativamente en el análisis y en la precisión de la estimación de la variable faltante. Estos **outliers** pueden sesgar los resultados y reducir la eficacia de los modelos de predicción, especialmente si se utilizan técnicas sensibles a valores extremos, como la regresión lineal estándar.

Para abordar este problema, es recomendable emplear **métodos de regresión robustos**, diseñados para minimizar el impacto de valores atípicos en el ajuste del modelo. Un ejemplo de este enfoque es la **regresión de Huber**, que combina las ventajas de la regresión lineal y la regresión por mínimos cuadrados, pero con un mecanismo que reduce la influencia de outliers al asignarles un menor peso en el cálculo de los coeficientes.

Otra alternativa es utilizar técnicas como la **regresión de Tukey biweight** o la **regresión de cuantiles**, que modelan la relación entre variables sin verse afectadas por la distribución de los datos extremos. Adicionalmente, se pueden aplicar **métodos de detección y tratamiento de outliers**, como el **recorte de datos (trimming)**, que elimina valores extremos por encima o por debajo de un umbral específico, o la **transformación de variables**, como el uso de logaritmos o escalado robusto, para reducir el impacto de valores extremos en el análisis.

# Analisis de regresión

Para explorar la relación entre las características conocidas de los exoplanetas, se lleva a cabo un **análisis de regresión lineal**. El objetivo es predecir el **radio del exoplaneta (`pl_radj`)** utilizando tres variables que podrían estar estrechamente relacionadas con su tamaño:

-   **`pl_ratdor`**: el cociente entre el radio del exoplaneta y el radio de su estrella, que proporciona una medida relativa del tamaño del planeta.\
-   **`pl_trandep`**: la profundidad del tránsito, que indica cuánto disminuye el brillo de la estrella cuando el exoplaneta pasa frente a ella, lo que está directamente relacionado con su radio.\
-   **`pl_rvamp`**: la amplitud de la velocidad radial del planeta, que refleja su efecto gravitacional sobre la estrella y puede aportar información sobre su masa y, en combinación con otras variables, su tamaño.

A través de este análisis, se busca comprender mejor cómo estas variables influyen en el tamaño de los exoplanetas y determinar cuál de ellas tiene un mayor impacto en la predicción de **`pl_radj`**.

## Regresión lineal univariada

Las variablies de características de los sistemas exoplanetarios tales como periodo orbital, radio planetario, temperatura de la estrella central del sistema y masa del planeta pueden inferirse indirectamente a partir de otras variables como excentricidad orbital, distancia a la estrella, caracteristicas de la estrella y otras. Se explorar un análisis de regresión lineal univariada con varias variables independientes evaluando la capacidad de predicción de cada modelo planteado.

Se realiza un análisis de regresión lineal univariada para predecir el radio del exoplaneta (**`pl_radj`**) consecutivamente a partir de las variables independientes seleccionadas.

### Regresión lineal: radio del exoplaneta según ratio del radio sobre el radio estelar (`pl_ratdor`)

```{r univar_reg_pl_ratdor}

# Regresion de pl_radj con pl_ratdor
model_pl_ratdor <- lm(pl_radj ~ pl_ratdor, data = kepler_data_num)

model_pl_ratdor_summary <- summary(model_pl_ratdor)

model_pl_ratdor_summary
```

```{r univar_reg_pl_ratdor_plot, echo=FALSE, warning=FALSE}

# Scatter plot de pl_radj vs pl_ratdor con la recta de regresión en rojo
# y los margenes de confianza en gris
ggplot(kepler_data_num, aes(x = pl_ratdor, y = pl_radj)) +
  geom_point(color = "steelblue") +
  geom_smooth(method = "lm", color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Regresión Lineal: Radio del Exoplaneta segun Ratio sobre el Radio Estelar",
       x = "Ratio sobre Radio Estelar",
       y = "Radio del Exoplaneta (Júpiter)") +
  theme_minimal()

```

Para el modelo de regresión planteado:

$$
pl\_radj = \beta_0 + \beta_1 \cdot pl\_ratdor + \varepsilon
$$

El análisis de regresión sugiere que la variable **`pl_ratdor`** no es un buen predictor del radio del exoplaneta (**`pl_radj`**). Según los resultados, por cada aumento de 1 unidad en **`pl_ratdor`**, se espera un incremento de apenas **0.0007341** en **`pl_radj`**. Sin embargo, el valor p asociado a esta relación (**Pr(\>\|t\|) = 0.152**) es mayor que **0.05**, lo que significa que **no hay suficiente evidencia estadística** para afirmar que **`pl_ratdor`** influye significativamente en **`pl_radj`**. Esto sugiere que el modelo planteado no es el más adecuado para estimar el radio del exoplaneta en función del cociente entre su radio y el radio de su estrella.

Este resultado se refuerza al revisar las estadísticas de ajuste del modelo. El **Error Estándar Residual** (**0.3872**) indica que los valores predichos se desvían bastante de los valores reales, lo que evidencia un ajuste impreciso. Además, el **R² múltiple** (**0.02618**) muestra que solo **el 2.6% de la variabilidad en `pl_radj`** es explicada por **`pl_ratdor`**, lo que indica un modelo con muy poca capacidad predictiva. De manera similar, el **R² ajustado** (**0.0137**), que corrige por el número de predictores, sigue siendo muy bajo, reforzando la idea de que **`pl_ratdor`** no contribuye significativamente a la predicción del radio del exoplaneta.

Por otro lado, el **F-statistic** (2.097) y su valor p (**0.1516**) confirman que el modelo, en su conjunto, **no es estadísticamente significativo**, lo que significa que no es capaz de explicar de manera fiable la relación entre estas variables.

A pesar de estos resultados, se realiza un análisis de los **residuos del modelo** para verificar si cumplen con los supuestos de la regresión lineal, con el objetivo de entender mejor las limitaciones del modelo y explorar posibles ajustes o alternativas.

```{r univar_reg_pl_ratdor_res_plot, echo=FALSE, warning=FALSE}

# Obtener los residuos y valores ajustados
res_pl_ratdor <- residuals(model_pl_ratdor)

# Estimar los valores ajustados
fit_val_pl_ratdor <- fitted(model_pl_ratdor)

# Crear un data frame con los residuos y valores ajustados
res_pl_ratdor_df <- data.frame(Fitted_Values = fit_val_pl_ratdor, Residuals = res_pl_ratdor)

# Scatter plot de residuos vs valores ajustados
ggplot(res_pl_ratdor_df, aes(x = Fitted_Values, y = Residuals)) +
  geom_point(color = "steelblue") +
  geom_hline(yintercept = 0, color = "indianred", linetype = "dashed") +
  labs(title = "Residuos vs Valores Ajustados",
       x = "Valores Ajustados",
       y = "Residuos") +
  theme_minimal()

```

El análisis de los residuos muestra que estos tienden a concentrarse en los valores ajustados más bajos, aproximadamente entre **0.4 y 0.5**. A medida que los valores ajustados aumentan, la dispersión de los residuos también parece **incrementar ligeramente**. Sin embargo, no se observa un patrón claro en forma de parábola o curva, lo que sugiere que la relación entre la variable independiente (**`pl_ratdor`**) y la dependiente (**`pl_radj`**) podría ser **aproximadamente lineal**.

En general, la mayoría de los residuos se encuentran relativamente **cerca de 0**, aunque hay algunos valores positivos elevados (**mayores a 0.5**), lo que indica que el modelo tiende a **subestimar ciertos valores** de **`pl_radj`**. Por otro lado, hay pocos residuos negativos extremos, lo que sugiere que el modelo **no está sobreestimando significativamente** los valores del radio del exoplaneta.

Se detecta una leve **heterocedasticidad**, ya que la dispersión de los residuos parece **mayor en los valores ajustados más altos**. Esto implica que el error no es completamente uniforme a lo largo de la distribución de valores ajustados, lo que podría afectar la **confiabilidad de las predicciones**. En un modelo ideal que cumpliera con la suposición de **homocedasticidad** (es decir, varianza constante de los errores), los residuos deberían distribuirse de manera más uniforme alrededor de la línea de referencia **(residuo = 0)**.

Dado que el modelo tiene un **R² muy bajo (\~2.6%)**, era esperable encontrar una dispersión alta en los residuos, lo que confirma que **`pl_ratdor` no es un buen predictor de `pl_radj`**. Además, la presencia de residuos elevados sugiere que existen **otras variables no consideradas** que podrían explicar mejor la variabilidad en el radio del exoplaneta.

```{r univar_reg_pl_ratdor_qq_plot, echo=FALSE, warning=FALSE}

# Crear un gráfico Q-Q de los residuos
qqnorm(res_pl_ratdor, main = "Gráfico Q-Q de los Residuos", col = "indianred")

```

Para que los residuos sigan una **distribución normal**, los puntos en la gráfica deberían alinearse con una **línea diagonal imaginaria**. Sin embargo, se observan **desviaciones** en los extremos, es decir, en los cuantiles más bajos y más altos, donde los puntos se alejan de la línea teórica. Esto indica la presencia de **colas más pesadas** de lo esperado en una distribución normal, lo que sugiere que existen **valores atípicos o que los residuos no siguen completamente una distribución normal**.

Además, se nota una **ligera curvatura en la parte central del gráfico**. Aunque la mayoría de los puntos se alinean con la línea teórica en esta región, la curvatura sugiere que los residuos no son **perfectamente normales**, lo que podría afectar la validez de algunas inferencias estadísticas.

La **regresión lineal** asume que los residuos deben seguir una distribución normal para garantizar la **validez de los intervalos de confianza y de los valores p**. En este caso, la curvatura y las colas pesadas plantean dudas sobre el cumplimiento de esta suposición. Si los residuos no son normales, la inferencia estadística del modelo podría verse afectada, aunque la estimación de los coeficientes seguiría siendo válida.

Para abordar este problema, una posible solución es aplicar **transformaciones en la variable dependiente** (**`pl_radj`**), como **logaritmos o raíces cuadradas**, para mejorar la normalidad de los residuos. Para confirmar estas observaciones, se realizan **pruebas de normalidad y homocedasticidad**, con el fin de evaluar si los residuos siguen efectivamente una distribución normal y si la **varianza de los errores se mantiene constante** a lo largo de los valores ajustados.

```{r univar_reg_pl_ratdor_shapiro_test}

# Prueba de normalidad de Shapiro-Wilk
shapiro_test_pl_ratdor <- shapiro.test(res_pl_ratdor)

shapiro_test_pl_ratdor

```

La **prueba de Shapiro-Wilk** es una herramienta estadística utilizada para determinar si un conjunto de datos sigue una **distribución normal**. En este análisis, se aplicó a los residuos del modelo para evaluar si cumplen con esta suposición fundamental en la regresión lineal.

Esta prueba parte de la **hipótesis nula (H₀)**, que establece que los residuos siguen una distribución normal. Si el resultado muestra un **p-valor muy bajo**, se rechaza esta hipótesis, indicando que los datos no se ajustan a una distribución normal.

El resultado de la prueba arrojó un **estadístico W de 0.81534**, lo que sugiere una desviación considerable de la normalidad, ya que un valor cercano a **1** indicaría que los datos se distribuyen de manera normal. Además, el **p-valor obtenido fue aproximadamente 0.00000001313**, lo que es significativamente menor a **0.05**. Esto proporciona suficiente evidencia para rechazar la hipótesis nula con un alto nivel de confianza, confirmando que los residuos **no siguen una distribución normal**.

Este resultado es relevante porque la falta de normalidad en los residuos puede afectar la validez de los **intervalos de confianza** y los **valores p** en la regresión. Para corregir este problema, podría ser necesario aplicar transformaciones a los datos o considerar el uso de métodos estadísticos más robustos que no dependan estrictamente de la normalidad de los residuos.

```{r univar_reg_pl_ratdor_bp_test}

# Prueba de homocedasticidad de Breusch-Pagan
library(lmtest)

# Prueba de Breusch-Pagan
bp_test_pl_ratdor <- bptest(model_pl_ratdor)

bp_test_pl_ratdor

```

El **test de Breusch-Pagan** es una prueba estadística utilizada para evaluar si los residuos del modelo presentan **homocedasticidad** (varianza constante) o **heterocedasticidad** (varianza no constante). La prueba parte de la **hipótesis nula**, que asume que los residuos tienen una varianza constante. Si se encuentra suficiente evidencia para rechazar esta hipótesis, se concluye que existe heterocedasticidad en el modelo.

En este análisis, el **estadístico de la prueba (BP)** obtuvo un valor de **1.1306**, el cual es relativamente bajo. Un valor alto de este estadístico indicaría la presencia de heterocedasticidad, pero en este caso no se observa una señal clara de ello. Dado que solo se utiliza un predictor, la prueba se basa en **un grado de libertad (df = 1)**. Además, el **p-valor obtenido fue de 0.2876**, lo que es superior al umbral de **0.05**. Esto significa que no hay suficiente evidencia estadística para rechazar la hipótesis nula, lo que sugiere que **no se detecta heterocedasticidad significativa en los residuos**.

A pesar de esto, el modelo no parece ajustarse bien a los datos, ya que se observa una gran dispersión en los residuos y la posible presencia de heterocedasticidad en ciertos rangos de los valores ajustados. Para mejorar el modelo, se exploran posibles **transformaciones en la variable dependiente**, como la aplicación de logaritmos. Además, se analiza si una **transformación logarítmica en las variables predictoras** podría mejorar la capacidad predictiva del modelo, utilizando para ello la **prueba de Box-Cox**, que permite determinar la mejor transformación para estabilizar la varianza y mejorar el ajuste del modelo.

```{r univar_reg_pl_ratdor_boxcox, warning=FALSE}

# Prueba de Box-Cox para transformar la variable st_rad
library(MASS)

# Prueba de Box-Cox
boxcox_pl_ratdor <- boxcox(model_pl_ratdor, lambda = seq(-2, 2, by = 0.1))

```

La **transformación de Box-Cox** es una técnica utilizada en modelos de regresión para encontrar la mejor manera de transformar la variable dependiente, con el fin de mejorar la **normalidad de los residuos** y garantizar una **varianza constante** (homocedasticidad).

La gráfica generada en este análisis muestra cómo varía la **log-verosimilitud** en función del **parámetro lambda**, el cual determina la forma de la transformación aplicada a la variable dependiente **Y**. Dependiendo del valor de **lambda**, la transformación puede ser una raíz cuadrada, un logaritmo, una inversa, entre otras, ayudando a estabilizar la varianza y mejorar el ajuste del modelo.

$$
Y' = 
\begin{cases}
\frac{Y^\lambda - 1}{\lambda}, & \lambda \neq 0 \\
\log(Y), & \lambda = 0
\end{cases}
$$

```{r univar_reg_pl_ratdor_boxcox_optimal_lambda, warning=FALSE}

# Obtener el lambda óptimo
lambda_optimal <- boxcox_pl_ratdor$x[which.max(boxcox_pl_ratdor$y)]

lambda_optimal

```

El valor óptimo del parámetro **lambda** obtenido en la transformación de **Box-Cox** es **-0.0202**, lo que indica que la mejor transformación para la variable **`pl_ratdor`** es cercana a **0**. Dado que un **lambda de 0** corresponde a una **transformación logarítmica**, aplicar el logaritmo a esta variable podría mejorar la capacidad predictiva del modelo de regresión lineal.

Para verificar si esta transformación realmente mejora el ajuste del modelo, se lleva a cabo una nueva **regresión lineal utilizando la variable transformada**. Luego, se evalúa el desempeño del modelo actualizado, analizando métricas como el **R²**, los **residuos** y la **significancia de los coeficientes** para determinar si la predicción de **`pl_radj`** mejora con la nueva transformación.

```{r univar_reg_pl_ratdor_log, warning=FALSE}

# Regresión de pl_radj con log(pl_ratdor) 
model_pl_ratdor_log <- lm(pl_radj ~ log(pl_ratdor), data = kepler_data_num)

model_pl_ratdor_log_summary <- summary(model_pl_ratdor_log)

model_pl_ratdor_log_summary

```

```{r univar_reg_pl_ratdor_log_plot, warning=FALSE}

# Scatter plot de pl_radj vs log(pl_ratdor) con la recta de regresión en rojo
# y los margenes de confianza en gris
ggplot(kepler_data_num, aes(x = log(pl_ratdor), y = pl_radj)) +
  geom_point(color = "steelblue") +
  geom_smooth(method = "lm", color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Regresión Lineal: Radio del Exoplaneta segun Logaritmo del Ratio sobre el Radio Estelar",
       x = "Logaritmo del Ratio sobre Radio Estelar",
       y = "Radio del Exoplaneta (Júpiter)") +
  theme_minimal()

```

El modelo ajustado con la transformación logarítmica de **`pl_ratdor`** muestra resultados muy similares al modelo original, lo que indica que la transformación **no mejoró significativamente la capacidad predictiva**. El **error estándar de los residuos** es **0.3876**, prácticamente idéntico al del modelo sin transformación (**0.3872**), lo que sugiere que la variabilidad de los residuos sigue siendo la misma.

El coeficiente de determinación **R² múltiple** es **0.02421 (2.4%)**, lo que significa que solo un **2.4% de la variabilidad de `pl_radj`** es explicada por **`log(pl_ratdor)`**, un valor extremadamente bajo. Incluso al ajustar por el número de predictores, el **R² ajustado** apenas mejora, quedando en **1.2%**, lo que refuerza la idea de que el modelo sigue sin capturar bien la relación entre las variables.

El **estadístico F**, con un valor de **1.935** y un **p-valor de 0.1681**, indica que no hay suficiente evidencia estadística para afirmar que la transformación logarítmica de **`pl_ratdor`** mejora significativamente el modelo.

En conclusión, el modelo sigue sin ser adecuado para predecir **`pl_radj`** a partir de **`pl_ratdor`**, incluso después de aplicar la transformación logarítmica. Ante estos resultados, se procede a probar con **otras variables predictoras o combinaciones de variables** para mejorar la capacidad de ajuste del modelo.

### Regresión lineal: radio del exoplaneta según la profundidad del tránsito (`pl_trandep`)

```{r univar_reg_pl_trandep}

# Regresion del radio del exploplaneta (pl_radj) 
# con la profundidad del tránsito del planeta (pl_trandep)
# como predictor
model_pl_trandep <- lm(pl_radj ~ pl_trandep, data = kepler_data_num)

model_pl_trandep_summary <- summary(model_pl_trandep)

model_pl_trandep_summary

```

```{r univar_reg_pl_trandep_plot, echo=FALSE, warning=FALSE}

# Scatter plot de pl_radj vs pl_trandep con la recta de regresión en rojo
# y los margenes de confianza en gris
ggplot(kepler_data_num, aes(x = pl_trandep, y = pl_radj)) +
  geom_point(color = "steelblue") +
  geom_smooth(method = "lm", color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Regresión Lineal: Radio del Exoplaneta vs Profundidad del Tránsito",
       x = "Profundidad del Tránsito (%)",
       y = "Radio del Exoplaneta (Júpiter)") +
  theme_minimal()

```

En el modelo:

$$
pl\_radj = \beta_0 + \beta_1 \cdot pl\_trandep + \varepsilon
$$

Cada aumento unitario en **`pl_trandep`** se asocia con un incremento de 0.61058 en **`pl_radj`**. Además es altamente significativo (con p-value \< 0.00000000000000022), lo que indica una fuerte relación entre **`pl_trandep`** y **`pl_radj`**. Además: El modelo de regresión planteado para predecir **`pl_radj`** en función de **`pl_trandep`** muestra una relación clara y significativa entre ambas variables. En este caso, **por cada aumento unitario en `pl_trandep`**, se observa un **incremento de 0.61058 en `pl_radj`**. Además, esta relación es altamente significativa, con un **p-valor extremadamente bajo** (\< 2.2 × 10⁻¹⁶), lo que indica que hay una fuerte conexión entre ambas variables.

El modelo presenta un **error estándar de los residuos de 0.08315**, lo que sugiere que la variabilidad en las predicciones es muy baja y, por lo tanto, el ajuste del modelo es bastante preciso. Además, el **coeficiente de determinación R²** alcanza un **94.02%**, lo que significa que el modelo explica **casi toda la variabilidad** de **`pl_radj`**. Incluso el **R² ajustado**, que corrige por el número de predictores, sigue siendo **muy alto (93.87%)**, lo que confirma la solidez del ajuste.

La prueba de **significancia global del modelo**, evaluada con el **estadístico F**, arroja un valor de **629.1** con un **p-valor extremadamente bajo**, lo que refuerza la validez del modelo y su capacidad para explicar la relación entre las variables.

En comparación con los modelos anteriores (**`pl_radj ~ pl_ratdor`** y **`pl_radj ~ log(pl_ratdor)`**), este nuevo modelo muestra una mejora **drástica** en el ajuste, con una capacidad explicativa mucho mayor. La relación entre **`pl_trandep`** y **`pl_radj`** no solo es fuerte, sino que también es estadísticamente **muy significativa**, lo que indica que **`pl_trandep`** es un excelente predictor del radio del exoplaneta.

```{r univar_reg_pl_trandep_res_plot, warning=FALSE}

# Obtener los residuos y valores ajustados
res_pl_trandep <- residuals(model_pl_trandep)

# Calcular los valores ajustados
fit_val_pl_trandep <- fitted(model_pl_trandep)

# Crear un data frame con los residuos y valores ajustados
res_pl_trandep_df <- data.frame(
  Residuals = res_pl_trandep,
  Fitted_Values = fit_val_pl_trandep
)

# Scatter plot de residuos vs valores ajustados
ggplot(res_pl_trandep_df, aes(x = Fitted_Values, y = Residuals)) +
  geom_point(color = "steelblue") +
  geom_hline(yintercept = 0, color = "indianred", linetype = "dashed") +
  labs(title = "Residuos vs Valores Ajustados",
       x = "Valores Ajustados",
       y = "Residuos") +
  theme_minimal()

```

El gráfico de **residuos vs valores ajustados** revela un patrón en la dispersión de los residuos. Para valores ajustados bajos, los residuos tienden a agruparse cerca de **0**, lo que indica una menor variabilidad en esta región. Sin embargo, a medida que los valores ajustados aumentan, los residuos se dispersan más, sugiriendo que el error del modelo no es uniforme en todo el rango de predicciones.

Este comportamiento sugiere la presencia de **heterocedasticidad**, ya que la dispersión de los residuos parece seguir un **patrón de parábola invertida**, con una mayor variabilidad en los valores ajustados más altos. La **heterocedasticidad** ocurre cuando la varianza de los errores no es constante, lo que puede afectar la fiabilidad de las inferencias estadísticas del modelo. Para confirmar si este problema está presente, se puede realizar el **test de Breusch-Pagan**, que evalúa si la varianza de los residuos cambia sistemáticamente con los valores ajustados.

En un modelo bien especificado, los residuos deberían distribuirse **de manera aleatoria** alrededor de la línea de referencia **(y=0)**, sin mostrar patrones claros. Sin embargo, en este caso, se observa una mayor concentración de puntos en la parte izquierda del gráfico, lo que sugiere que el modelo podría no estar captando completamente la relación entre **`pl_radj`** y **`pl_trandep`**. Este comportamiento indica que el modelo podría beneficiarse de una revisión, como la inclusión de nuevas variables explicativas o la aplicación de transformaciones para mejorar la estabilidad de la varianza de los errores.

```{r univar_reg_pl_trandep_qq_plot, warning=FALSE}

# Crear un gráfico Q-Q de los residuos
qqnorm(res_pl_trandep, main = "Gráfico Q-Q de los Residuos", col="indianred")

```

El **gráfico Q-Q (Quantile-Quantile)** de los residuos permite evaluar si estos siguen una **distribución normal** comparando sus cuantiles con los de una distribución normal teórica. En este caso, los puntos del gráfico se alinean bastante bien con la **línea diagonal**, lo que indica que, en general, los residuos siguen un **comportamiento cercano a la normalidad**.

Sin embargo, se observan **pequeñas desviaciones en los extremos**, tanto en los valores más negativos como en los más positivos. Esto sugiere la presencia de **colas más pesadas** en la distribución de los residuos o la existencia de algunos **valores atípicos leves**. A pesar de estas desviaciones, no parecen ser lo suficientemente grandes como para indicar una **violación grave de la normalidad**.

Para complementar este análisis y confirmar si los residuos cumplen con los **supuestos de normalidad y homocedasticidad**, se realizan pruebas estadísticas específicas. Estas pruebas permiten verificar con mayor precisión si los residuos siguen efectivamente una distribución normal y si la **varianza de los errores es constante** en todo el rango de valores ajustados. Si se detectan problemas significativos, podrían ser necesarias transformaciones en los datos o el uso de modelos más robustos para mejorar la validez del análisis.

```{r univar_reg_pl_trandep_shapiro_test}

# Prueba de normalidad de Shapiro-Wilk
shapiro_test_pl_trandep <- shapiro.test(res_pl_trandep)

shapiro_test_pl_trandep

```

La **prueba de Shapiro-Wilk** se utilizó para evaluar si los residuos del modelo siguen una distribución normal. El resultado arrojó un **estadístico W de 0.98715**, un valor cercano a **1**, lo que indica que los datos se ajustan bien a una distribución normal. Además, el **p-valor obtenido fue de 0.9115**, lo que, al ser mayor que **0.05**, significa que no hay suficiente evidencia estadística para rechazar la **hipótesis nula**. En otras palabras, los residuos **no presentan desviaciones significativas de la normalidad**.

Este resultado confirma que el **supuesto de normalidad de los residuos se cumple**, lo que hace que el modelo sea **estadísticamente válido para realizar inferencias**. Además, es coherente con la observación del **gráfico Q-Q**, que ya sugería una buena alineación de los residuos con la distribución normal. Esto refuerza la confianza en la fiabilidad del modelo y en la precisión de sus estimaciones.

```{r univar_reg_pl_trandep_bp_test}

# Prueba de homocedasticidad de Breusch-Pagan
library(lmtest)

# Prueba de Breusch-Pagan
bp_test_pl_trandep <- bptest(model_pl_trandep)

bp_test_pl_trandep

```

El **test de homocedasticidad de Breusch-Pagan** se utilizó para evaluar si la varianza de los errores en el modelo es constante. Los resultados muestran un **estadístico BP de 6.2822**, lo que sugiere una mayor evidencia de **heterocedasticidad**. Dado que solo se incluye un predictor en el modelo, la prueba se basa en **un grado de libertad**. Además, el **p-valor obtenido fue de 0.0122**, lo que, al ser menor que **0.05**, indica que se debe **rechazar la hipótesis nula** y concluir que los residuos presentan **heterocedasticidad significativa**. En otras palabras, la varianza de los errores no es constante en todo el rango de valores ajustados.

Esta violación de la suposición de **homocedasticidad** puede afectar la **precisión de las estimaciones y pruebas de hipótesis**, haciendo que los **intervalos de confianza y valores p sean menos confiables** debido a la variabilidad desigual en los errores del modelo.

Dado que esta condición puede comprometer la validez de los resultados, es importante considerar estrategias para corregir la heterocedasticidad. Una opción es aplicar una **transformación en la variable dependiente**, como el **logaritmo (`log(Y)`) o la raíz cuadrada (`sqrt(Y)`)**, para estabilizar la varianza de los errores. Otra alternativa es utilizar una **regresión robusta con errores estándar de White**, que ajusta los errores para hacerlos menos sensibles a la heterocedasticidad. También puede aplicarse una **regresión ponderada (WLS, Weighted Least Squares)**, en la que se asignan pesos a las observaciones para compensar la variabilidad desigual en los errores, especialmente si la heterocedasticidad está relacionada con una variable específica.

Como primer intento de corrección, se aplicará una **transformación a la variable dependiente `pl_radj`**, con el objetivo de reducir la heterocedasticidad y mejorar la estabilidad del modelo.

```{r univar_reg_pl_trandep_boxcox, warning=FALSE}

# Prueba de Box-Cox para transformar la variable pl_trandep
library(MASS)

# Prueba de Box-Cox
boxcox_pl_trandep <- boxcox(model_pl_trandep, lambda = seq(-2, 2, by = 0.1))

```

El análisis de la **transformación de Box-Cox** muestra que el **pico de la curva** ocurre aproximadamente en **lambda ≈ 2**, lo que indica que la mejor transformación para la variable dependiente se encuentra en esa región. Como este valor está dentro del intervalo de confianza, se considera una opción adecuada para transformar los datos y mejorar el ajuste del modelo.

Dado que el valor óptimo de lambda es cercano a **2**, la transformación sugerida para la variable dependiente es **elevarla al cuadrado (`Y²`)**. Este tipo de transformación puede ayudar a estabilizar la varianza de los residuos y mejorar la linealidad de la relación entre las variables.

Por otro lado, no se recomienda utilizar una **transformación logarítmica (`log(Y)`)** correspondiente a **lambda = 0**, ni la **raíz cuadrada (`sqrt(Y)`)**, que correspondería a **lambda = 0.5**. Ambas opciones quedan fuera del intervalo óptimo definido por la prueba y, por lo tanto, no ofrecerían una mejora significativa en la normalidad de los residuos ni en la homocedasticidad del modelo.

```{r univar_reg_pl_trandep_square_transf}

# Regresión de pl_radj^2 con pl_trandep
model_pl_trandep_square <- lm(I(pl_radj^2) ~ pl_trandep, data = kepler_data_num)

model_pl_trandep_square_summary <- summary(model_pl_trandep_square)

model_pl_trandep_square_summary

```

```{r univar_reg_pl_trandep_square_transf_scat_plot}

# Scatter plot de pl_radj^2 vs pl_trandep con la recta de regresión en rojo
# y los margenes de confianza en gris
ggplot(kepler_data_num, aes(x = pl_trandep, y = I(pl_radj^2)))+
  geom_point(color = "steelblue") +
  geom_smooth(method = "lm", color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Regresión Lineal: Radio del Exoplaneta al Cuadrado segun Profundidad del Tránsito",
       x = "Profundidad del Tránsito (%)",
       y = "Radio del Exoplaneta al Cuadrado (Júpiter^2)") +
  theme_minimal()

```

$$
pl\_radj^2 = \beta_0 + \beta_1 \cdot pl\_trandep + \varepsilon
$$

El análisis del modelo después de aplicar la transformación cuadrática muestra una mejora significativa en su precisión y capacidad predictiva. El **error estándar de los residuos** se redujo a **0.04049**, un valor menor en comparación con el modelo sin transformación, lo que indica una mayor precisión en las predicciones.

El modelo ahora explica **el 99.14% de la variabilidad en `pl_radj²`**, con un **R² de 0.9914**, lo que refleja un ajuste excepcional. Incluso al corregir por el número de predictores, el **R² ajustado** sigue siendo extremadamente alto, con un valor de **0.9912**, lo que confirma que la relación entre las variables es muy sólida.

Además, el **estadístico F**, con un valor de **4,596** y un **p-valor extremadamente bajo (\< 2.2 × 10⁻¹⁶)**, demuestra que el modelo es altamente significativo.

En general, la transformación cuadrática mejoró notablemente el ajuste en comparación con el modelo original. La relación entre **`pl_trandep`** y **`pl_radj²`** no solo es fuerte, sino también estadísticamente significativa, lo que sugiere que este modelo es una representación más precisa de la relación entre las variables.

```{r univar_reg_pl_trandep_square_transf_res_plot, warning=FALSE}

# Obtener los residuos y valores ajustados
res_pl_trandep_square <- residuals(model_pl_trandep_square)

# Calcular los valores ajustados
fit_val_pl_trandep_square <- fitted(model_pl_trandep_square)

# Crear un data frame con los residuos y valores ajustados
res_pl_trandep_square_df <- data.frame(
  Residuals = res_pl_trandep_square,
  Fitted_Values = fit_val_pl_trandep_square
)

# Scatter plot de residuos vs valores ajustados
ggplot(res_pl_trandep_square_df, aes(x = Fitted_Values, y = Residuals)) +
  geom_point(color = "steelblue") +
  geom_hline(yintercept = 0, color = "indianred", linetype = "dashed") +
  labs(title = "Residuos vs Valores Ajustados",
       x = "Valores Ajustados",
       y = "Residuos") +
  theme_minimal()

```

Los residuos tienen menor dispersión, lo que confirma que la heterocedasticidad detectada anteriormente fue reducida con la transformación.

```{r univar_reg_pl_trandep_square_transf_qq_plot, warning=FALSE}

# Crear un gráfico Q-Q de los residuos
qqnorm(res_pl_trandep_square, main = "Gráfico Q-Q de los Residuos", col="indianred")

```

En el gráfico Q-Q de los residuos, los puntos se alinean bastante bien con la línea diagonal, lo que sugiere que los residuos siguen una distribución normal. Aunque hay una pequeña desviación en los extremos (valores muy negativos y positivos), la desviación no es severa.

```{r univar_reg_pl_trandep_square_transf_shapiro_test}

# Prueba de normalidad de Shapiro-Wilk
shapiro_test_pl_trandep_square <- shapiro.test(res_pl_trandep_square)

shapiro_test_pl_trandep_square

```

El **test de normalidad de Shapiro-Wilk** arroja un **estadístico W de 0.8507** y un **p-valor de 0.00006504**, lo que indica que los residuos **no siguen una distribución normal**. A pesar de que en el **gráfico Q-Q** los puntos parecían alinearse de manera razonable con la línea diagonal, la prueba estadística proporciona evidencia suficiente para rechazar la hipótesis de normalidad.

```{r univar_reg_pl_trandep_square_transf_bp_test}

library(lmtest)
# Prueba de homocedasticidad de Breusch-Pagan
bp_test_pl_trandep_square <- bptest(model_pl_trandep_square)

bp_test_pl_trandep_square

```

El **test de Breusch-Pagan** arroja un **estadístico BP de 14.87**, con **1 grado de libertad** y un **p-valor de 0.0001152**, lo que indica que los residuos presentan **heterocedasticidad significativa**. Esto significa que la varianza de los errores no es constante en todo el modelo, lo que puede afectar la fiabilidad de las inferencias estadísticas.

Aunque la **transformación cuadrática** aplicada a la variable dependiente ayudó a **reducir la heterocedasticidad**, los resultados muestran que aún persiste en cierta medida. Esto sugiere que, aunque el modelo ha mejorado, puede ser necesario aplicar **otras estrategias**, como regresión ponderada o el uso de errores estándar robustos, para garantizar una estimación más estable y confiable.

### Regresión lineal: radio del exoplaneta según la amplitud de la velocidad radial (`pl_rvamp`)

```{r univar_reg_pl_rvamp}

# Regresion del radio del exoplaneta (pl_radj) 
# utilizando la amplitude de la velocidad radial del planeta (pl_rvamp)
# como predictor
model_pl_rvamp <- lm(pl_radj ~ pl_rvamp, data = kepler_data_num)

model_pl_rvamp_summary <- summary(model_pl_rvamp)

model_pl_rvamp_summary

```

```{r univar_reg_pl_rvamp_plot, echo=FALSE, warning=FALSE}

# Scatter plot de pl_radj vs pl_rvamp con la recta de regresión en rojo
# y los margenes de confianza en gris
ggplot(kepler_data_num, aes(x = pl_rvamp, y = pl_radj)) +
  geom_point(color = "steelblue") +
  geom_smooth(method = "lm", color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Regresión Lineal: Radio del Exoplaneta segun Amplitud de la Velocidad Radial",
       x = "Amplitud de la Velocidad Radial (ma/s)",
       y = "Radio del Exoplaneta (Júpiter)") +
  theme_minimal()

```

Para el modelo de regresión planteado:

$$
pl\_radj = \beta_0 + \beta_1 \cdot pl\_rvamp + \varepsilon
$$

Las estadísticas del modelo muestran que:

El modelo presenta un **R² de 0.5367**, lo que indica que **explica el 53.67% de la variabilidad en `pl_radj`**. Esto sugiere una relación **moderada a fuerte** entre las variables, aunque todavía queda un **46.33% de variabilidad sin explicar**, lo que implica que otros factores podrían estar influyendo en la variable dependiente.

El **R² ajustado** es **0.5297**, lo que significa que, incluso al corregir por el número de predictores, el modelo sigue manteniendo un **buen nivel de ajuste**. Además, el **estadístico F** tiene un valor de **76.46**, con un **p-valor extremadamente bajo**, lo que confirma que el modelo es **altamente significativo** y que la relación entre las variables no es producto del azar.

A pesar de que el modelo tiene un ajuste razonable, no es tan preciso como el obtenido en la regresión de **`pl_radj ~ pl_trandep`**. Sin embargo, la relación entre **`pl_rvamp` y `pl_radj`** sigue siendo **estadísticamente significativa** y muestra un nivel de asociación importante, lo que sugiere que `pl_rvamp` es un predictor relevante, aunque no el más fuerte disponible.

```{r univar_reg_pl_rvamp_res_plot, warning=FALSE}

# Obtener los residuos y valores ajustados
res_pl_rvamp <- residuals(model_pl_rvamp)

# Calcular los valores ajustados
fit_val_pl_rvamp <- fitted(model_pl_rvamp)

# Crear un data frame con los residuos y valores ajustados
res_pl_rvamp_df <- data.frame(
  Residuals = res_pl_rvamp,
  Fitted_Values = fit_val_pl_rvamp
)

# Scatter plot de residuos vs valores ajustados
ggplot(res_pl_rvamp_df, aes(x = Fitted_Values, y = Residuals)) +
  geom_point(color = "steelblue") +
  geom_hline(yintercept = 0, color = "indianred", linetype = "dashed") +
  labs(title = "Residuos vs Valores Ajustados",
       x = "Valores Ajustados",
       y = "Residuos") +
  theme_minimal()

```

El análisis de los residuos revela que su **dispersión no es constante** a lo largo de los valores ajustados, lo que sugiere la posible presencia de **heterocedasticidad**. En los valores ajustados más pequeños (**menores a 0.5**), los residuos están **muy concentrados**, lo que indica una menor variabilidad en esta región. Sin embargo, a medida que los valores ajustados aumentan (**mayores a 1.0**), los residuos muestran una dispersión mucho mayor, lo que sugiere que la **varianza de los errores no es constante en todo el modelo**.

La presencia de **heterocedasticidad** puede indicar que el modelo **no está capturando adecuadamente la variabilidad de los datos**, lo que podría afectar la precisión de sus predicciones. Para corregir este problema, se pueden aplicar **transformaciones en las variables**, como el uso de logaritmos o raíces cuadradas, o utilizar **métodos de regresión robustos** que ajusten los errores estándar para hacerlos menos sensibles a la variabilidad desigual.

Además, si los residuos muestran una **tendencia curva o patrones de agrupación**, esto podría ser una señal de que el **modelo lineal no es la mejor opción**. En estos casos, podría ser necesario recurrir a un **modelo no lineal** o incluir **términos polinomiales** en la regresión para capturar mejor la relación entre las variables y mejorar la precisión del ajuste.

```{r univar_pl_rvamp_eqt_qq_plot, warning=FALSE}

# Crear un gráfico Q-Q de los residuos
qqnorm(res_pl_rvamp, main = "Gráfico Q-Q de los Residuos", col="indianred")

```

El análisis del **gráfico Q-Q de los residuos** muestra **desviaciones significativas en los extremos**, especialmente en los cuantiles más bajos y más altos. Esto sugiere que la distribución de los residuos **no sigue completamente una distribución normal** y que **las colas de la distribución son más pesadas de lo esperado**. En otras palabras, hay más valores extremos en los residuos de lo que se esperaría en una distribución normal ideal.

Los residuos más alejados de la media, tanto en la dirección **negativa como positiva**, se desvían notablemente de la **línea teórica**, lo que indica la presencia de valores atípicos que podrían estar afectando el modelo. A pesar de esto, la mayor parte de los puntos en la **zona central** del gráfico parecen alinearse mejor con la distribución normal, aunque los extremos muestran una curvatura evidente.

La falta de normalidad en los residuos pone en duda la **validez de los intervalos de confianza y las pruebas de hipótesis del modelo**, ya que muchos procedimientos estadísticos dependen de esta suposición. La presencia de valores extremos también sugiere que **outliers o una distribución sesgada** podrían estar influyendo en el comportamiento del modelo. Para abordar este problema, se pueden considerar **transformaciones de las variables, la eliminación de valores atípicos** o el uso de **modelos más robustos** que no dependan estrictamente de la normalidad de los errores.

```{r univar_reg_pl_rvamp_shapiro_test}

# Prueba de normalidad de Shapiro-Wilk
shapiro_test_pl_rvamp <- shapiro.test(res_pl_rvamp)

shapiro_test_pl_rvamp

```

El resultado de la **prueba de normalidad de Shapiro-Wilk** indica que los residuos **no siguen una distribución normal**, con un **estadístico W de 0.86708** y un **p-valor de 0.000003207**. Dado que este p-valor es extremadamente bajo, hay suficiente evidencia para rechazar la hipótesis de normalidad.

Aunque en el **gráfico Q-Q** los residuos parecían alinearse en cierta medida con la línea diagonal, la prueba estadística confirma que **existen desviaciones significativas**. Esto sugiere que los residuos podrían estar influenciados por la **presencia de valores atípicos** o que su distribución tiene características diferentes a las de una normal ideal.

La falta de normalidad en los residuos podría afectar la **validez de los intervalos de confianza y las pruebas de hipótesis**, lo que hace necesario considerar posibles soluciones, como aplicar **transformaciones a los datos**, eliminar valores extremos o utilizar **métodos estadísticos más robustos** que no dependan estrictamente de la normalidad de los errores.

```{r univar_reg_pl_rvamp_rvamp_bp_test}

# Prueba de homocedasticidad de Breusch-Pagan
library(lmtest)

# Prueba de Breusch-Pagan
bp_test_pl_rvamp <- bptest(model_pl_rvamp)

bp_test_pl_rvamp

```

El resultado del **test de Breusch-Pagan** indica la presencia de **heterocedasticidad significativa**, con un **estadístico BP de 10.096** y un **p-valor de 0.001486**. Esto significa que la **varianza de los errores no es constante**, lo que puede comprometer la precisión de las **estimaciones del modelo y las pruebas de hipótesis**.

Dado que el modelo no cumple con la **suposición de homocedasticidad** y, además, los residuos **no siguen una distribución normal**, se busca corregir la heterocedasticidad mediante una **transformación de la variable dependiente**. Para determinar cuál es la mejor transformación, se lleva a cabo una **prueba de Box-Cox**, que permite identificar la forma más adecuada para estabilizar la varianza de los errores y mejorar el ajuste del modelo.

```{r univar_reg_pl_rvamp_boxcox, warning=FALSE}

# Prueba de Box-Cox para transformar la variable pl_rvamp
library(MASS)

# Prueba de Box-Cox
boxcox_pl_rvamp <- boxcox(model_pl_rvamp, lambda = seq(-2, 2, by = 0.1))

```

El **pico de la curva** en la prueba de **Box-Cox** se encuentra cerca de **lambda = 0**, lo que indica que la mejor transformación para la variable dependiente se encuentra en esa zona. En términos prácticos, cuando el valor óptimo de **lambda (λ)** es **0**, la transformación recomendada es el **logaritmo natural** de la variable dependiente.

Dado que **λ = 0 está dentro del intervalo de confianza**, esto confirma que aplicar una **transformación logarítmica (`log(Y)`)** es la opción más adecuada. Este tipo de transformación es útil porque puede **reducir la heterocedasticidad**, mejorar la **normalidad de los residuos** y hacer que la relación entre las variables sea **más lineal**, lo que permite que el modelo de regresión tenga un mejor ajuste y sea más preciso en sus estimaciones.

```{r univar_reg_pl_rvamp_log_transf}

# Regresión de log(pl_radj) con logpl_rvamp
model_pl_rvamp_log <- lm(log(pl_radj) ~ log(pl_rvamp), data = kepler_data_num)

model_pl_rvamp_log_summary <- summary(model_pl_rvamp_log)

model_pl_rvamp_log_summary

```

```{r univar_reg_pl_rvamp_log_transf_plot, echo=FALSE, warning=FALSE}

# Scatter plot de log(pl_radj) vs pl_rvamp con la recta de regresión en rojo
# y los margenes de confianza en gris
ggplot(kepler_data_num, aes(x = pl_rvamp, y = log(pl_radj))) +
  geom_point(color = "steelblue") +
  geom_smooth(method = "lm", color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Regresión Lineal: Logaritmo del Radio del Exoplaneta segun Logaritmo de la Amplitud de la Velocidad Radial",
       x = "Logaritmo de la Amplitud de la Velocidad Radial",
       y = "Logaritmo del Radio del Exoplaneta (Júpiter)") +
  theme_minimal()

```

Para el modelo de regresión planteado:

$$
log(pl\_radj) = \beta_0 + \beta_1 \cdot pl\_rvamp + \varepsilon
$$

El análisis del modelo después de aplicar la **transformación logarítmica** muestra una mejora significativa en su capacidad predictiva. El **R² obtenido es de 84.25%**, lo que indica que el modelo explica una gran parte de la variabilidad en **log(`pl_radj`)**, representando un ajuste excelente. Este resultado es considerablemente mejor que el del modelo sin transformación, donde el **R² era aproximadamente 53.67%**.

Incluso al corregir por el número de predictores, el **R² ajustado** sigue siendo alto, con un valor de **84.01%**, lo que confirma que el modelo mantiene su solidez y no se ve afectado por un exceso de predictores innecesarios. Además, el **estadístico F**, con un valor de **353** y un **p-valor extremadamente bajo (\< 2.2 × 10⁻¹⁶)**, confirma que el modelo es altamente significativo y que la relación entre las variables no es producto del azar.

En conclusión, la **transformación logarítmica ha mejorado significativamente el ajuste del modelo** en comparación con el modelo sin transformación. La relación entre **`pl_rvamp` y `log(pl_radj`)** es fuerte y altamente significativa, lo que sugiere que este modelo es mucho más adecuado para describir la relación entre estas variables y ofrece estimaciones más precisas.

```{r univar_reg_pl_rvamp_log_transf_res_plot, warning=FALSE}

# Obtener los residuos y valores ajustados
res_pl_rvamp_log <- residuals(model_pl_rvamp_log)

# Calcular los valores ajustados
fit_val_pl_rvamp_log <- fitted(model_pl_rvamp_log)

# Crear un data frame con los residuos y valores ajustados
res_pl_rvamp_log_df <- data.frame(
  Residuals = res_pl_rvamp_log,
  Fitted_Values = fit_val_pl_rvamp_log
)

# Scatter plot de residuos vs valores ajustados
ggplot(res_pl_rvamp_log_df, aes(x = Fitted_Values, y = Residuals)) +
  geom_point(color = "steelblue") +
  geom_hline(yintercept = 0, color = "indianred", linetype = "dashed") +
  labs(title = "Residuos vs Valores Ajustados",
       x = "Valores Ajustados",
       y = "Residuos") +
  theme_minimal()

```

Después de aplicar la transformación, se observa una **reducción en la dispersión de los residuos**, lo que indica que la **heterocedasticidad detectada previamente ha disminuido considerablemente**. Esto significa que la **varianza de los errores es ahora más constante** a lo largo de los valores ajustados, cumpliendo mejor con la suposición de **homocedasticidad** en la regresión lineal.

La disminución en la variabilidad de los residuos sugiere que el modelo ha logrado un ajuste más estable y confiable. Esto no solo mejora la **precisión de las estimaciones**, sino que también aumenta la **validez de los intervalos de confianza y las pruebas de hipótesis**, ya que las predicciones del modelo son menos sensibles a valores extremos o patrones no deseados en los errores.

```{r univar_reg_pl_rvamp_log_transf_qq_plot, warning=FALSE}

# Crear un gráfico Q-Q de los residuos
qqnorm(res_pl_rvamp_log, main = "Gráfico Q-Q de los Residuos", col="indianred")

```

La **alineación de los puntos con la línea diagonal** en el gráfico sugiere que los residuos siguen **aproximadamente una distribución normal**. La mayor parte de los puntos se ajusta bien a la línea teórica, lo que indica que el supuesto de normalidad en los residuos se cumple en gran medida.

Sin embargo, en los **extremos del gráfico**, correspondientes a los valores más negativos y más positivos de los residuos, se observa una **ligera desviación**. Esto sugiere que la distribución de los residuos tiene **colas ligeramente más pesadas**, lo que implica la posible presencia de algunos valores atípicos o extremos.

A pesar de esta leve desviación en los valores extremos, el patrón general indica que **los residuos siguen una distribución normal de manera aceptable**. Esto significa que el modelo sigue siendo **estadísticamente válido** para realizar inferencias, aunque la presencia de valores extremos podría justificar un análisis más detallado si se requiere mayor precisión en las estimaciones.

```{r univar_reg_pl_rvamp_log_transf_shapiro_test}

# Prueba de normalidad de Shapiro-Wilk
shapiro_test_pl_rvamp_log <- shapiro.test(res_pl_rvamp_log)

shapiro_test_pl_rvamp_log

```

El **test de normalidad de Shapiro-Wilk** arroja un **estadístico W de 0.97622** y un **p-valor de 0.2188**, lo que indica que no hay evidencia suficiente para rechazar la hipótesis de normalidad. Esto significa que los **residuos siguen una distribución normal**, cumpliendo con una de las principales suposiciones del modelo.

Si bien el **gráfico Q-Q** ya mostraba una buena alineación de los puntos con la línea diagonal, la prueba estadística **confirma de manera más rigurosa** que los residuos no presentan desviaciones significativas respecto a una distribución normal. Esto refuerza la validez del modelo y la fiabilidad de sus estimaciones.

```{r univar_reg_pl_rvamp_log_transf_bp_test}

# Prueba de homocedasticidad de Breusch-Pagan
library(lmtest)

# Prueba de Breusch-Pagan
bp_test_pl_rvamp_log <- bptest(model_pl_rvamp_log)

bp_test_pl_rvamp_log

```

El **test de homocedasticidad de Breusch-Pagan** muestra un **estadístico BP de 0.48865** y un **p-valor de 0.4845**, lo que indica que no hay evidencia de **heterocedasticidad significativa** en el modelo. Esto significa que la **varianza de los errores es constante**, cumpliendo con una de las suposiciones clave de la regresión lineal. Dado que los modelos anteriores presentaban problemas de heterocedasticidad, estos resultados confirman que **la transformación logarítmica aplicada a la variable dependiente corrigió eficazmente este problema**.

Tras evaluar los **tres modelos de regresión lineal univariada**, se concluye que el modelo **`pl_radj ~ pl_rvamp` con transformación logarítmica** es el que ofrece el **mejor ajuste**.

$$
log(pl\_radj) = \beta_0 + \beta_1 \cdot pl\_rvamp + \varepsilon
$$

Este modelo explica el **84.25% de la variabilidad en `log(pl_radj)`**, lo que indica una capacidad predictiva excelente. Además, la relación entre **`pl_rvamp` y `log(pl_radj)`** es **fuerte y altamente significativa**, con residuos que siguen una **distribución normal** y **no presentan heterocedasticidad significativa**.

### Conclusión sobre los modelos lineales univariados planteados

A lo largo del análisis, se probaron diferentes enfoques para ajustar la relación entre las variables, considerando tanto modelos sin transformación como con transformaciones matemáticas para mejorar su estabilidad. Inicialmente, los modelos sin transformación mostraron **problemas de heterocedasticidad y normalidad en los residuos**, lo que afectaba la validez de sus inferencias. Sin embargo, la **aplicación de una transformación logarítmica a la variable dependiente (`pl_radj`) permitió corregir estos problemas**, logrando un modelo más estable y confiable.

```{r univar_reg_summary}

# Resumen de los modelos de regresión lineal univariada
model_summaries <- list(
  model_pl_ratdor_summary,
  model_pl_trandep_summary,
  model_pl_trandep_square_summary,
  model_pl_rvamp_summary,
  model_pl_rvamp_log_summary
)

model_summaries

```

El **modelo final con transformación logarítmica** no solo ofrece un mejor ajuste y mayor capacidad explicativa, sino que también cumple con los **supuestos clave de la regresión lineal**, lo que lo convierte en la mejor opción para modelar la relación entre **`pl_radj`** y **`pl_rvamp`**. Este resultado subraya la importancia de evaluar la calidad del ajuste y de realizar **transformaciones adecuadas** cuando se detectan desviaciones en los supuestos del modelo, garantizando así estimaciones más precisas y robustas.

## Regresión lineal multivariada

Para mejorar la precisión en la predicción del **radio del exoplaneta (`pl_radj`)**, se lleva a cabo un **análisis de regresión lineal multivariada**. En este enfoque, se consideran simultáneamente tres variables explicativas que podrían influir en el radio del exoplaneta:

1.  **El cociente del radio planetario sobre el radio estelar (`pl_ratdor`)**, que representa el tamaño relativo del exoplaneta en comparación con su estrella.\
2.  **La profundidad del tránsito (`pl_trandep`)**, que mide la disminución en el brillo de la estrella cuando el exoplaneta pasa frente a ella, lo que está directamente relacionado con su tamaño.\
3.  **La amplitud de la velocidad radial del planeta (`pl_rvamp`)**, que refleja el impacto gravitacional del exoplaneta sobre su estrella y puede proporcionar información sobre su masa y, en combinación con otras variables, su radio.

Este modelo de regresión multivariada permite analizar **cómo estas tres variables influyen en conjunto** en la predicción del radio del exoplaneta, en lugar de evaluar cada una por separado. Al considerar múltiples factores al mismo tiempo, se espera obtener un **modelo más preciso y robusto**, capaz de capturar mejor la variabilidad en los datos y proporcionar estimaciones más confiables del tamaño de los exoplanetas.

```{r multivar_reg}

# Regresion de pl_radj con pl_ratdor, pl_trandep y pl_rvamp
model_multivar <- lm(pl_radj ~ pl_ratdor + pl_trandep + pl_rvamp, data = kepler_data_num)

model_multivar_summary <- summary(model_multivar)

model_multivar_summary

```

El modelo de regresión planteado:

$$
pl\_radj = \beta_0 + \beta_1 \cdot pl\_ratdor + \beta_2 \cdot pl\_trandep + \beta_3 \cdot pl\_rvamp + \varepsilon
$$ Presenta buenas estadísticas por cuanto:

El modelo de regresión muestra un **excelente ajuste**, explicando el **97.31% de la variabilidad en `pl_radj`**. Incluso después de ajustar por el número de predictores, el **R² ajustado sigue siendo alto, con un 95.3%**, lo que indica que el modelo generaliza bien y mantiene una fuerte capacidad predictiva. Además, el **estadístico F de 48.28** y un **p-valor de 0.0013** confirman que el modelo en su conjunto es **altamente significativo**, lo que sugiere que al menos una de las variables predictoras tiene un impacto relevante en la estimación de **`pl_radj`**.

Sin embargo, existen algunas limitaciones importantes. Después de eliminar los datos con valores faltantes, **solo quedan 4 observaciones efectivas**, lo que es **extremadamente bajo** para un modelo con tres predictores. Esta reducción drástica en la cantidad de datos puede hacer que el modelo sea poco confiable y que las estimaciones de los coeficientes sean **inestables**, ya que se basan en una muestra demasiado pequeña.

Además, se han descartado **2,539 observaciones** debido a valores faltantes, lo que plantea la necesidad de revisar la estructura del dataset. Evaluar si se pueden recuperar más observaciones permitiría mejorar la estabilidad del modelo y evitar conclusiones basadas en un número tan reducido de datos.

Dado que la variable **`pl_trandep`** es la más significativa dentro del modelo, una posible alternativa sería **simplificar la regresión eliminando `pl_ratdor` y `pl_rvamp`**, dejando solo **`pl_trandep`** como predictor. Esto llevaría al segundo modelo evaluado, que podría ofrecer un ajuste igualmente bueno pero con una estructura más sencilla y posiblemente más robusta frente a la escasez de datos.

## Regresión logística

Para predecir la habitabilidad de los exoplanetas, se realiza un análisis de regresión logística utilizando las variables conocidas de los exoplanetas y las estrellas del sistema. Se seleccionan las variables conocidas de los exoplanetas y las estrellas como variables independientes y la habitabilidad como variable dependiente.

Existen varios indicadores de habitabilidad de los exoplanetas. Considerando que estamos estudiando estrellas con radios similiares al solar (+/- 10%) los parámetros planetarios más relevantes se describen a continuación.

La temperatura de equilibrio (**`pl_eqt`**) planetaria es una variable fundamental en la definición de la zona habitable, ya que está directamente relacionada con la posibilidad de agua líquida en la superficie de un planeta. En [@kopparapu-ramirez-2013] se analizan factores para ajustar los límites de la zona habitable y define los rangos ideales de temperatura para habitabilidad. - La insolación (**`pl_insol`**), esto es flujo de radiación recibido por el planeta en comparación con la Tierra, es otro predictor clave, ya que determina el balance energético del planeta. En [@shields-ballard-2016] se estudian los efectos del flujo de radiación en la zona habitable y su impacto en la capacidad de un planeta para retener agua. - El semieje mayor orbital (`pl_orbsmax`) es otro indicador importante, ya que determina la distancia del planeta a su estrella anfitriona y, por lo tanto, su temperatura superficial. En [@kane-gelino-2012] se demuestra cómo la distancia orbital y la luminosidad de la estrella afectan la habitabilidad.

La determinación de la habitabilidad de un exoplaneta es un tema complejo y multifactorial que depende de varios indicadores físicos y químicos. Si bien no existe una fórmula única universalmente aceptada para calcular la "habitabilidad", se pueden combinar los indicadores antes mencionados para aproximar el potencial de habitabilidad de un exoplaneta. Una de las aproximaciones más comunes es usar una combinación ponderada de las condiciones adecuadas para la presencia de agua líquida, ya que esta es fundamental para la vida tal como la conocemos. El uso de una combinación lineal ponderada de variables tales como las consideradas es una técnica válida en la modelización de habitabilidad planetaria. En [@mendez-rivera-2021] se propone el Earth Similarity Index (ESI), que usa una fórmula normalizada combinando temperatura, flujo estelar y parámetros orbitales.

Así con los indicadores seleccionados definimos un Índice de Habitabilidad Planetaria (PHI - Planetary Habitability Index) como una función normalizada que combine los indicadores clave:

$$
\text{PHI} = w_1 \cdot f_1(\text{pl_eqt}) + w_2 \cdot f_2(\text{pl_insol}) + w_3 \cdot f_3(\text{pl_orbsmax}) 
$$

Donde:

-   $w_i$ son los pesos normalizados asociados a cada indicador sumando 1.
-   $f_i(x)$ son funciones de transformación o normalización que convierten las medidas en valores entre 0 y 1, según el rango de habitabilidad conocido.

Estas variables se consideran como posibles predictores de la habitabilidad de los exoplanetas cuando están en determinados rangos.

### Temperatura de equilibrio (`pl_eqt`)

Idealmente la temperatua de equilibrio debe estar en un rango compatible con agua líquida, aproximadamente entre 0°C y 100°C. Así la normalización resultan en:

$$
f_i(\text{pl_eqt}) = \max\left(0, \min\left(1, \frac{\text{pl_eqt} - T_{\text{min}}}{T_{\text{max}} - T_{\text{min}}}\right)\right)
$$

Donde $T_{\text{min}}$ y $T_{\text{max}}$ son los límites inferiores y superiores. El agua líquida, esencial para la vida, puede existir en un rango de temperaturas superficiales de aproximadamente 273K (0 °C) a 373K (100 °C). Sin embargo, debido a factores atmosféricos y de presión, este rango puede extenderse ligeramente: $T_{\text{min}}=200K$ puede ser el umbral inferior, considerando atmósferas densas como la de Marte y $T_{\text{max}}=400K$ puede considerarse el umbral superior, considerando atmósferas con alta presión como la de Venus.

Según la literatura especializada el peso de la temperatura de equilibrio en el índice de habitabilidad es de $w_1=0.40$ cuando se considera la temperatura de equilibrio como un indicador preponderante de habitabilidad y no se tienen muchos más datos del planeta.

### La insolación (`pl_insol`)

La insolación es la cantidad de energía recibida por el planeta y es un indicador importante de la habitabilidad. La insolación se mide en unidades de flujo de energía recibida por unidad de área y se puede normalizar en un rango de 0 a 1. La insolación ideal para la vida es aquella que permite la presencia de agua líquida en la superficie del planeta (generalmente valores cercanos a la Tierra son ideales). La insolación se puede normalizar considerando que La Tierra tiene una insolación de 1S (donde $S$ es la insolación solar a la distancia de la Tierra) y se puede considerar que la vida puede existir en un rango de insolación de $I_{min}=0.3S$ (aproximadamente el límite interior de la zona habitable para una estrella como el Sol, más allá de este valor el agua podría congelarse) a $I_{max}=1,7S$ (aproximadamente el límite exterior de la zona habitable, más allá de este valor el agua podría evaporarse). Así la normalización resulta en:

$$
f_2(\text{pl_insol}) = \max\left(0, \min\left(1, \frac{\text{pl_insol} - I_{\text{min}}}{I_{\text{max}} - I_{\text{min}}}\right)\right)
$$

La insolación es un factor crítico para mantener agua líquida en la superficie del planeta, pero su impacto depende de otros factores como la atmósfera y el albedo, según la literatura especializada el peso de la insolación en el índice de habitabilidad es de $w_2=0.30$. Es importante destacar que El rango de $I_{min}$ e $I_{max}$ puede variar según la luminosidad de la estrella, ya que la zona habitable cambia en función del tipo estelar por lo que esta estimación sirve para estrellas similares al Sol.

### La distancia orbital del semieje mayor (`pl_orbsmax`)

La distancia orbital semieje mayor es un indicador de la zona habitable de un sistema planetario. La distancia orbital semieje mayor se mide en unidades astronómicas (UA) y se puede normalizar en un rango de 0 a 1. La distancia orbital semieje mayor ideal para la vida es aquella que permite la presencia de agua líquida en la superficie del planeta. La distancia orbital semieje mayor se puede normalizar considerando que La Tierra tiene una distancia orbital semieje mayor de 1 UA y se puede considerar que la vida puede existir en un rango de distancias de $D_{\text{min}}=0,5$ UA (aproximadamente el límite interior de la zona habitable para una estrella como el Sol, más allá de este valor el agua podría congelarse) a $D_{\text{max}}=2$ UA (aproximadamente el límite exterior de la zona habitable, más allá de este valor el agua podría evaporarse). Estos rangos pueden variar según el tipo de estrella. Así la normalización resulta en:

$$
f_3(\text{pl_orbsmax}) = \max\left(0, \min\left(1, \frac{\text{pl_orbsmax} - D_{\text{min}}}{D_{\text{max}} - D_{\text{min}}}\right)\right)
$$

En la mayoría de los modelos, el peso para el valor normalizado de **`pl_orbsmax`** oscila entre 15% y 25%. Esto se debe a que **`pl_orbsmax`** complementa indicadores más directos como **`pl_eqt`** (temperatura de equilibrio) y **`pl_insol`** (insolación). Se tomará un peso de $w_3=0.30$.

### Índice de habitabilidad planetaria (`PHI`)

Por lo expuesto anteriormente, el **Índice de Habitabilidad Planetaria (PHI)** se calcula utilizando **variables normalizadas** y sus respectivos **pesos**, lo que permite evaluar la habitabilidad de un exoplaneta de manera más equilibrada y comparable entre diferentes sistemas.

La fórmula para calcular el **PHI** que se utilizará en el modelo de regresión logística es:

$$
\text{PHI} = 0.4 \cdot f_1(\text{pl_eqt}) + 0.3 \cdot f_2(\text{pl_insol}) + 0,3 \cdot f_3(\text{pl_orbsmax}) 
$$

```{r log_reg_phi_calculation}

library(dplyr)

# Crear un data frame con las variables seleccionadas
kepler_data_logistic <- kepler_data %>%
  dplyr::select(pl_eqt, pl_insol, pl_orbsmax)

# Normalizar las variables
kepler_data_logistic_normalized <- kepler_data_logistic %>%
  mutate(
    pl_eqt_normalized = pmin(1, pmax(0, (pl_eqt - 200) / (400 - 200))),
    pl_insol_normalized = pmin(1, pmax(0, (pl_insol - 0.3) / (1.7 - 0.3))),
    pl_orbsmax_normalized = pmin(1, pmax(0, (pl_orbsmax - 0.05) / (2 - 1.05)))
  )

# Calcular el índice de habitabilidad planetaria (PHI)
kepler_data_logistic_normalized <- kepler_data_logistic_normalized %>%
  mutate(
    phi = 0.4 * pl_eqt_normalized + 0.3 * pl_insol_normalized + 0.3 * pl_orbsmax_normalized 
  )

# Remover columnas no normalizadas
kepler_data_logistic_normalized <- subset(kepler_data_logistic_normalized, select = -c(pl_eqt, pl_insol, pl_orbsmax))

```

```{r log_reg}

# Crear un modelo de regresión logística
model_logistic <- glm(phi ~ ., data = kepler_data_logistic_normalized, family = binomial)

model_logistic_summary <- summary(model_logistic)

model_logistic_summary

```

```{r log_reg_plot, echo=FALSE, warning=FALSE}

# Graficar la curva logistica del modelo
# Crear un data frame con los valores de PHI y las probabilidades predichas
# de habitabilidad. Seleccionar solo los registros donde se conoce la habitabilidad
phi_prob <- predict(model_logistic, type = "response")

# Filtrar los registros donde se conoce la habitabilidad
kepler_data_logistic_normalized <- kepler_data_logistic_normalized %>%
  filter(!is.na(phi))

phi_prob_df <- data.frame(PHI = kepler_data_logistic_normalized$phi, Probabilidad = phi_prob)

# Scatter plot de PHI vs Probabilidad
ggplot(phi_prob_df, aes(x = PHI, y = Probabilidad)) +
  geom_point(color = "steelblue") +
  geom_smooth(method = "glm", method.args = list(family = "binomial"), color = "indianred", fill = "grey", alpha = 0.2) +
  labs(title = "Curva Logística del Modelo de Regresión",
       x = "PHI",
       y = "Probabilidad") +
  theme_minimal()

```

El **modelo de regresión logística** obtenido no es particularmente sólido debido a la **escasez de datos disponibles** para calcular el **PHI (Planetary Habitability Index)**. En este caso, la cantidad de **exoplanetas con información completa** sobre los factores clave para la predicción, como **temperatura de equilibrio, insolación y semieje mayor orbital**, es **muy limitada**, con solo **17 observaciones** disponibles.

La baja cantidad de datos afecta significativamente la **precisión y confiabilidad** del modelo, ya que un tamaño de muestra tan reducido **limita la capacidad de generalización** y hace que los coeficientes del modelo sean **menos estables**. Para obtener un modelo más robusto y representativo, sería necesario contar con **un mayor número de exoplanetas con datos completos**, lo que permitiría entrenar la regresión con más información y mejorar la validez de las predicciones sobre habitabilidad.

El **modelo de regresión logística** planteado presenta varias limitaciones que afectan su utilidad y confiabilidad.

$$
\log \left( \frac{P(\phi = 1)}{1 - P(\phi = 1)} \right) = \beta_0 + \beta_1 \cdot \text{pl_eqt_normalized} + \beta_2 \cdot \text{pl_insol_normalized} + \beta_3 \cdot \text{pl_orbsmax_normalized}
$$

Uno de los principales problemas es la **drástica reducción en la deviance residual**, que pasó de **0.4535** (sin predictores) a **0.0006** (con predictores). Si bien una reducción en la deviance suele indicar una mejora en el modelo, en este caso el valor **extremadamente bajo** sugiere un **sobreajuste**, lo que significa que el modelo está ajustándose demasiado a los pocos datos disponibles y podría no generalizar bien a nuevas observaciones.

El **criterio de información de Akaike (AIC)**, con un valor de **19.641**, indica que el modelo penaliza adecuadamente la complejidad, pero la **falta de significancia en los coeficientes** sugiere que **no es útil para la predicción**, ya que no logra establecer una relación clara entre las variables.

Otro problema grave es la **eliminación de datos faltantes**, que dejó **solo 17 observaciones disponibles** después de descartar **2,530 registros incompletos**. Con tan pocos datos, los **grados de libertad (df=13) son extremadamente bajos**, lo que **afecta la estabilidad del modelo** y hace que las estimaciones sean poco confiables.

En su estado actual, el modelo no es útil, ya que **no cuenta con variables predictoras significativas** y enfrenta **una pérdida masiva de datos**, lo que limita su capacidad para hacer inferencias válidas. Antes de sacar conclusiones sobre la relación entre **PHI** y las variables predictoras, sería recomendable **limpiar los datos y probar un modelo más simple**. Sin embargo, dada la **escasez de observaciones**, es posible que no sea factible construir un modelo confiable para la **predicción de habitabilidad** en estas condiciones.

# Posibles mejoras para futuros análisis

Para mejorar el **modelo de regresión logística**, una posible solución es abordar el problema de los **valores faltantes** en las variables clave utilizadas para calcular el **PHI**: **temperatura de equilibrio (`pl_eqt`), insolación (`pl_insol`) y semieje mayor orbital (`pl_orbsmax`)**. En lugar de descartar todas las observaciones con datos faltantes, se puede aplicar **regresión lineal** para estimar estos valores en función de otras variables relacionadas dentro del conjunto de datos. Al hacer esto, se logra recuperar una mayor cantidad de observaciones, lo que aumentaría el tamaño de la muestra utilizada en la regresión logística y mejoraría la estabilidad del modelo.

Sin embargo, utilizar variables estimadas mediante regresión como **input en otro modelo predictivo** conlleva ciertos **riesgos e implicaciones estadísticas**. Cuando una variable ha sido generada mediante una predicción previa, **su error de estimación se transfiere al modelo final**, en este caso, a la regresión logística. Como resultado, el modelo puede **subestimar la incertidumbre real** y producir **intervalos de confianza demasiado optimistas**, ya que no está considerando los errores asociados a las predicciones previas.

Además, el uso de **valores regresionados** puede introducir **colinealidad artificial**, especialmente si la variable imputada depende de otras variables que ya están incluidas en la regresión logística. Esto puede distorsionar los coeficientes y hacer que el modelo sea menos interpretable. También es posible que la **estructura de los errores en las variables imputadas** no sea idéntica a la de los valores observados originalmente, lo que podría generar un sesgo en las estimaciones del modelo.

Para mitigar estos riesgos, se pueden aplicar estrategias como la **validación cruzada** para evaluar el impacto de las variables imputadas en el desempeño del modelo y realizar un **análisis de sensibilidad**, probando el modelo con y sin las variables imputadas para verificar la estabilidad de los resultados. Además, una opción más robusta sería utilizar **métodos de imputación múltiple**, que generan varias versiones de los datos imputados y permiten incorporar la incertidumbre en las predicciones finales.

En conclusión, aunque la regresión lineal de las variables faltantes puede ayudar a recuperar observaciones y mejorar la estabilidad del modelo logístico, es importante ser consciente de los **errores de predicción acumulados** y del impacto que pueden tener en la validez de las estimaciones. Evaluar cuidadosamente estos aspectos garantizará que el modelo final sea más confiable y que sus conclusiones sean interpretadas con la debida cautela.

# Conclusiones

El análisis realizado permitió evaluar diferentes modelos de regresión para predecir el radio de los exoplanetas y explorar la relación entre sus características físicas. Se probaron modelos de regresión lineal y logística, incluyendo transformaciones para mejorar la normalidad de los residuos y corregir problemas de heterocedasticidad. Los resultados indicaron que el modelo **`pl_radj ~ pl_rvamp` con transformación logarítmica** fue el más efectivo, explicando el **84.25% de la variabilidad** en el radio del exoplaneta y cumpliendo con los principales supuestos estadísticos. Sin embargo, el modelo de **regresión logística** para predecir la habitabilidad planetaria presentó limitaciones debido a la escasez de datos completos, lo que afectó su estabilidad y capacidad predictiva.

Para mejorar la calidad de los modelos, es fundamental abordar el problema de los valores faltantes, ya sea mediante **imputación de datos** o la recolección de más observaciones. Además, al utilizar variables estimadas en modelos posteriores, se debe considerar el impacto de los **errores de predicción acumulados** en los resultados finales. Si bien las transformaciones de datos ayudaron a mejorar la precisión de algunos modelos, la falta de datos sigue siendo una limitación clave para la predicción de la **habitabilidad planetaria**. Futuras investigaciones deberían centrarse en ampliar el conjunto de datos y explorar enfoques más robustos, como modelos de aprendizaje automático, que podrían mejorar la capacidad predictiva de estos análisis.

# Referencias
